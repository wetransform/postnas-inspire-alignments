<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<alignment xmlns="http://www.esdi-humboldt.eu/hale/alignment">
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.geometry.simplefeature" name="Simple Feature Geometrie" type="groovy">
            <cf:input eager="true" maxOccurs="1" minOccurs="1" name="geometrie"/>
            <cf:output eager="false" maxOccurs="1" minOccurs="1"/>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def geoms = _.geom.toSimpleGeometries(geometries: _.geom.aggregate(geometrie), collections: false)
if (geoms) {
	if (geoms.size() &gt; 1) {
		_log.error("Mehrere Geometrien gefunden - Aufteilung nötig")
	}
	_target(geoms[0])
}
else {
	_log.error("Keine Geometrie gefunden")
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Überführt die Quell-Geometrien als eine zusammengefasste Simple Feature Geometrie (ohne Multi-Geometrien).

Nur erfolgreich falls genau eine Simple Feature Geometrie gebildet werden kann. Andernfalls wird ein entsprechender Fehler in die Transformations-Logs eingetragen.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.geometry.simplefeature.multi" name="Simple Feature Geometrie (Multi)" type="groovy">
            <cf:input eager="true" maxOccurs="1" minOccurs="1" name="geometrie"/>
            <cf:output eager="false" maxOccurs="1" minOccurs="1"/>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def geoms = _.geom.toSimpleGeometries(geometries: _.geom.aggregate(geometrie), collections: true)
if (geoms) {
	if (geoms.size() &gt; 1) {
		_log.error("Mehrere Geometrien gefunden - Aufteilung nötig")
	}
	_target(geoms[0])
}
else {
	_log.error("Keine Geometrie gefunden")
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Überführt die Quell-Geometrien als eine zusammengefasste Simple Feature Geometrie (ggf. als Multi-Geometrie).

Nur erfolgreich falls genau eine Simple Feature Geometrie gebildet werden kann. Andernfalls wird ein entsprechender Fehler in die Transformations-Logs eingetragen.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.AX_Lagebezeichnung.GeographicalName" name="AX_Lagebezeichnung zu GeographicalName" type="groovy">
            <cf:input eager="false" maxOccurs="1" minOccurs="1" name="lagebezeichnung">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:input eager="false" maxOccurs="1" minOccurs="0" name="source">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:type name="GeographicalNameType" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </cf:output>
            <cf:param maxOccurs="1" minOccurs="0" name="source">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Quelle des Namens. Falls nicht angegeben wird sie aus einer Projekt-Variable bestimmt.</core:text>
                </cf:description>
                <cf:display value="Source of name"/>
                <cf:binding>java.lang.String</cf:binding>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nameStatus">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Status des Namens. Falls nicht angegeben wird als Standardwert official angenommen.</core:text>
                </cf:description>
                <cf:display value="nameStatus"/>
                <cf:value>standardised</cf:value>
                <cf:value>other</cf:value>
                <cf:value>official</cf:value>
                <cf:value>historical</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nativeness">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Ortsüblichkeit des Namens. Falls nicht angegeben wird als Standardwert endonym angenommen.</core:text>
                </cf:description>
                <cf:display value="nativeness"/>
                <cf:value>endonym</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>exonym</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def name = lagebezeichnung.p.unverschluesselt.value()

if (!name) {
	// Namen auch aus verschlüsselter Lagebezeichnung ableiten
	
	def gemeinde = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.gemeinde.value()
	def kreis = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.kreis.value()
	def lage = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.lage.value()
	def land = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.land.value()
	def reg = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.regierungsbezirk.value()

	if (land &amp;&amp; gemeinde &amp;&amp; kreis &amp;&amp; lage) {
		if (!reg) reg = '0'
		def schluesselGesamt = "$land$reg$kreis$gemeinde$lage"
		
		withTransformationContext {
			def collect = _.context.collector(it)
	  
			// Name zu Schlüssel der Lagebezeichnung aus Index holen
			if (collect.lagebezeichnung[schluesselGesamt].value()){
				name = collect.lagebezeichnung[schluesselGesamt].value()
			}
			else _log.error("Für einen Namen aus einer verschlüsselten Lagebezeichnung mit Schlüssel ${schluesselGesamt} liegt kein Katalogeintrag vor.")
		}
	}
}

if (name) {
	def sourceName_var = _project.vars.get('ADV_MODELLART', null)

	_target {
		// source

		// Priorität 1 - feste Quelle
		if (_params.source) {
			sourceOfName( _params.source )
		}
		// Priorität 2 - aus Projektvariable
		else if (sourceName_var) {
			sourceOfName( sourceName_var )
		}
		else {
			sourceOfName {
				nilReason( 'unknown' )
			}
		}

		// nativeness
		def nn = _params.nativeness
		if (nn) {
			if (nn == 'unpopulated') {
				nativeness {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (nn == 'unknown') {
				nativeness {
					nilReason( 'unknown' )
				}
			}
			else {
				nativeness {
					href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/' + nn )
				}
			}
		}
		else {
			// default for nativeness if not specified is endonym
			nativeness {
				href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/endonym' )
			}
		}

		// nameStatus
		def ns = _params.nameStatus
		if (ns) {
			if (ns == 'unpopulated') {
				nameStatus {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (ns == 'unknown') {
				nameStatus {
					nilReason( 'unknown' )
				}
			}
			else {
				nameStatus {
					href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/' + ns )
				}
			}
		}
		else {
			// default for nameStatus if not specified is official
			nameStatus {
				href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/official' )
			}
		}

		// spelling
		spelling {
			SpellingOfName {
				text( name )
				script( 'Latn' )
			}
		}
		// language
		language( 'deu' )
	}
}
else {
	throw new NoResultException()
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Erstellt ein GeographicalName-Objekt aus einer Lagebezeichnung.&#13;
Eine unverschlüsselte Lagebezeichnung wird direkt als Name übernommen.&#13;
Falls stattdessen eine verschlüsselte Lagebezeichnung vorliegt (nur in ALKIS/DLKM möglich), wird versucht den Namen über den Schlüssel in einem Index nachzuschlagen.&#13;
Trifft keiner der beiden Fälle zu, oder kann der Name nicht nachgeschlagen werden, wird kein GeographicalName erzeugt.&#13;
&#13;
Die Sprache des Namens wird als Deutsch angenommen.&#13;
&#13;
&lt;% if (_params.nameStatus) {&#13;
  if (_params.nameStatus == 'unpopulated') {&#13;
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."&#13;
  }&#13;
  else if (_params.nameStatus == 'unknown') {&#13;
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."&#13;
  }&#13;
  else {&#13;
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als ${_params.nameStatus} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."&#13;
  }&#13;
}&#13;
else {&#13;
  out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als *official* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."&#13;
}&#13;
out &lt;&lt; "\n\n"&#13;
if (_params.nativeness) {&#13;
  if (_params.nativeness == 'unpopulated') {&#13;
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."&#13;
  }&#13;
  else if (_params.nativeness == 'unknown') {&#13;
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."&#13;
  }&#13;
  else {&#13;
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als ${_params.nativeness} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."&#13;
  }&#13;
}&#13;
else {&#13;
  out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als *endonym* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."&#13;
}&#13;
out &lt;&lt; "\n\n"&#13;
if (_params.source) {&#13;&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird als ${_params.source} angegeben."&#13;&#13;
} else {&#13;&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird aus einer Projekt-Variable (`ADV_MODELLART`) bestimmt, falls vorhanden."&#13;&#13;
} %&gt;
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.GeographicalName.simple" name="Einfacher GeographicalName (Deutsch)" type="groovy">
            <cf:input eager="false" maxOccurs="1" minOccurs="1" name="spelling">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:input eager="true" maxOccurs="1" minOccurs="0" name="source">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:type name="GeographicalNameType" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </cf:output>
            <cf:param maxOccurs="1" minOccurs="0" name="source">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Quelle des Namens. Falls nicht angegeben wird sie aus einer Projekt-Variable oder, falls konfiguriert, aus dem Quell-Objekt bestimmt.</core:text>
                </cf:description>
                <cf:display value="Source of name"/>
                <cf:binding>java.lang.String</cf:binding>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nameStatus">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Status des Namens. Falls nicht angegeben wird als Standardwert official angenommen.</core:text>
                </cf:description>
                <cf:display value="nameStatus"/>
                <cf:value>standardised</cf:value>
                <cf:value>other</cf:value>
                <cf:value>official</cf:value>
                <cf:value>historical</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nativeness">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Ortsüblichkeit des Namens. Falls nicht angegeben wird als Standardwert endonym angenommen.</core:text>
                </cf:description>
                <cf:display value="nativeness"/>
                <cf:value>endonym</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>exonym</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def sourceNameFromModellart() {
	if (source) {
		def modelle = source.p.AA_Modellart.advStandardModell.values()
		if (modelle) {
			//TODO Logik um korrektes anzugebendes Modell zu bestimmen?
			//XXX Vorerst wird erstes Modell zurückgegeben
			return modelle[0]
		}
	}
	
	null
}

def sourceName_input = sourceNameFromModellart()
def sourceName_var = _project.vars.get('ADV_MODELLART', null)

if (spelling) {
	_target {
		
		// Priorität 1 - feste Quelle
		if (_params.source) {
			sourceOfName( _params.source )
		}
		// Priorität 2 - aus Projektvariable
		else if (sourceName_var) {
			sourceOfName( sourceName_var )
		}
		// Priorität 3 - aus Quell-Objekt
		else if (sourceName_input) {
			sourceOfName( sourceName_input )
		}
		else {
			sourceOfName {
				nilReason( 'unknown' )
			}
		}
		pronunciation {
			nilReason( 'other:unpopulated' )
		}
		// nameStatus
		def ns = _params.nameStatus
		if (ns) {
			if (ns == 'unpopulated') {
				nameStatus {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (ns == 'unknown') {
				nameStatus {
					nilReason( 'unknown' )
				}
			}
			else {
				nameStatus {
					href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/' + ns )
				}
			}
		}
		else {
			// default for nameStatus if not specified is official
			nameStatus {
				href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/official' )
			}
		}
		// nativeness
		def nn = _params.nativeness
		if (nn) {
			if (nn == 'unpopulated') {
				nativeness {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (nn == 'unknown') {
				nativeness {
					nilReason( 'unknown' )
				}
			}
			else {
				nativeness {
					href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/' + nn )
				}
			}
		}
		else {
			// default for nativeness if not specified is endonym
			nativeness {
				href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/endonym' )
			}
		}
		spelling {
			SpellingOfName {
				text( spelling )
				script ( 'Latn' )
			}
		}
		language( 'deu' )
	}
}
else {
	throw new NoResultException()
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Bildet ein GeographicalName-Objekt zu einem einfachen Namen. Der Wert des Quell-Attributs $spelling wird als Schreibweise des Namens übernommen (`SpellingOfName`).&#13;
&#13;
Die Sprache wird als Deutsch angenommen.&#13;

&lt;% if (_params.nameStatus) {
  if (_params.nameStatus == 'unpopulated') {
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."
  }
  else if (_params.nameStatus == 'unknown') {
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."
  }
  else {
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als ${_params.nameStatus} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."
  }
}
else {
  out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als *official* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."
}
out &lt;&lt; "\n\n"
if (_params.nativeness) {
  if (_params.nativeness == 'unpopulated') {
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."
  }
  else if (_params.nativeness == 'unknown') {
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."
  }
  else {
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als ${_params.nativeness} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."
  }
}
else {
  out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als *endonym* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."
}
out &lt;&lt; "\n\n"
if (_params.source) {&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird als ${_params.source} angegeben."&#13;
} else if (source) {&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird aus einer Projekt-Variable (`ADV_MODELLART`) bestimmt, falls vorhanden, andernfalls wird das Quell-Attribut $source dafür herangezogen. "&#13;
  out &lt;&lt; "In letzterem Fall kann nur eine von potentiell mehreren im Quellobjekt angegebenen Modellarten übernommen werden."&#13;
} else {&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird aus einer Projekt-Variable (`ADV_MODELLART`) bestimmt, falls vorhanden."&#13;
} %&gt;
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.date.earliest" name="Jüngstes Datum" type="groovy">
            <cf:input eager="true" maxOccurs="-1" minOccurs="1" name="dates">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
//import java.text.SimpleDateFormat
//def formatter = new SimpleDateFormat('yyyy-MM-dd')

// all source dates as list
def values = dates.p.values()

if (!values) {
	// no result
	return null
}

// try to convert to date
values = values.collect { value -&gt;
	def result
	//XXX skip instanceof check - instanceof is not supported by Groovy Sandbox
	// and Class.isInstance requires the Groovy restriction to be lifted
	//if (Date.isInstance(value)) {
	//	result = value
	//}
	//TODO also support parsing based on provided pattern?
	
	if (result == null) {
		//try block to make sure the function is not cancelled in case an error occurs
		try {
			//specific format reported by RLP
			result = Date.parse("yyyy-MM-dd'T'HH:mm:ss", value)
		}
		catch (e) {
  			// ignore, try next variant
  		}
	}
	if (result == null) {
		// try hale conversion
				//try block to make sure the function is not cancelled in case an error occurs
		try{
			result = _.convert(value: value, to: Date)
		}
		catch (e) {
  			// ignore, try next variant
  		}
	}
	if (result == null) {
		result = value as Date
	}
	result
}

// sort dates
values.sort()

// yield last date
values[-1]
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Liefert das jüngste Datum/Zeit aller Eingabedaten.</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.id.default" name="AdV INSPIRE localId" type="groovy">
            <cf:input eager="true" maxOccurs="-1" minOccurs="1" name="id">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:param maxOccurs="1" minOccurs="0" name="collectorName">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Name eines Kollektors, der verwendet werden soll, um die erzeugten IDs zu sammeln.</core:text>
                </cf:description>
                <cf:display value="Collector name"/>
                <cf:binding>java.lang.String</cf:binding>
            </cf:param>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// alle Quell-IDs als Liste
def identifiers = id.p.values()

def id

if (identifiers.size() == 1) {
  // verwende Original-ID falls nur eine Quelle
  id = identifiers[0]
}
else {
  // sortieren (TODO spezielle Ordnung benötigt?)
  identifiers = identifiers.sort()

  def identString = identifiers.join()

  id = '_' + _.crypto.sha256(identString)
}

// Ziel-Typ als Präfix
if (true /*_params.useTargetTypePrefix*/) {
  def targetType = _targetType.definition.name.localPart
  if (targetType) {
    if (targetType.endsWith('Type')) {
      targetType = targetType[0..-5]
    }
  
    if (!id.startsWith('_')) {
      id = '_' + id
    }
    id = targetType + id
  }
}

// Falls ein Collector-Name angegeben wurde, IDs in diesem einspeisen

if (_params.collectorName) {
  withTransformationContext {
    def c = _.context.collector(it)
    c[_params.collectorName] &lt;&lt; id
  }
}

id
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Bestimmung einer INSPIRE localId oder GML id aus Fachkennzeichen oder AAA-ObjektIDs.

Für eine einzige Quell-ID wird diese direkt herangezogen.

Andernfalls wird unter Verwendung des SHA256-Algorithmus ein Hash-Wert aus den sortierten und dann konkatenierten Quell-IDs gebildet und hexadezimal kodiert.

Außerdem wird der Name des Feature-Typs des Ziel-Modells als Präfix vorangestellt. Dabei wird sichergestellt dass der Typ-Name von den weiteren Teilen der ID durch einen Unterstrich getrennt ist.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.identifier" name="AdV INSPIRE identifier (URI)" type="groovy">
            <cf:input eager="true" maxOccurs="-1" minOccurs="1" name="id">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:type name="CodeWithAuthorityType" ns="http://www.opengis.net/gml/3.2"/>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// alle Quell-IDs als Liste
def identifiers = id.p.values()

def id

if (identifiers.size() == 1) {
  // verwende Original-ID falls nur eine Quelle
  id = identifiers[0]
}
else {
  // sortieren (TODO spezielle Ordnung benötigt?)
  identifiers = identifiers.sort()

  def identString = identifiers.join()

  id = '_' + _.crypto.sha256(identString)
}

// Ziel-Typ als Präfix
if (true /*_params.useTargetTypePrefix*/) {
  def targetType = _targetType.definition.name.localPart
  if (targetType) {
    if (targetType.endsWith('Type')) {
      targetType = targetType[0..-5]
    }
  
    if (!id.startsWith('_')) {
      id = '_' + id
    }
    id = targetType + id
  }
}

// Verknüpfung mit namespace
def namespace = _project.vars.INSPIRE_NAMESPACE
if (namespace) {
  if (!namespace.endsWith('/')) {
    namespace = namespace + '/'
  }
  
  // namespace und id als Ergebnis
  _target(namespace + id) {
	codeSpace( 'http://inspire.ec.europa.eu/ids' )
  }
}
else {
  // nur id als Ergebnis
  _target(id) {
	codeSpace( 'http://inspire.ec.europa.eu/ids' )
  }
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Bestimmung eines GML identifiers URI bestehend INSPIRE namespace und localId aus Fachkennzeichen oder AAA-ObjektIDs.

Für eine einzige Quell-ID wird diese direkt für die localId herangezogen. Andernfalls wird unter Verwendung des SHA256-Algorithmus ein Hash-Wert aus den sortierten und dann konkatenierten Quell-IDs gebildet und hexadezimal kodiert.
Als Präfix wird der localId der Name des Feature-Typs des Ziel-Modells vorangestellt. Dabei wird sichergestellt dass der Typ-Name von den weiteren Teilen der ID durch einen Unterstrich getrennt ist.

Der für Datenanbieter und Datensatz spezifische Namespace muss als Vorgabe (Projekt-Variable) konfiguriert werden.

Der `codeSpace` für den GML identifier wird als `http://inspire.ec.europa.eu/ids` gesetzt.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.namespace" name="AdV INSPIRE ID namespace" type="groovy">
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// verwende Wert aus Projekt-Variable "INSPIRE_NAMESPACE"
_project.vars.INSPIRE_NAMESPACE
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Setzt $_target auf den für den Datensatz vorgegebenen festen INSPIRE Namespace.

Der für Datenanbieter und Datensatz spezifische Namespace muss dafür als Vorgabe (Projekt-Variable) konfiguriert werden.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.uom.toucum" name="AdV Maßeinheit zu UCUM" type="groovy">
            <cf:input eager="false" maxOccurs="1" minOccurs="1" name="uom">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
if (!uom) {
	throw new NoResultException()
}

def result

// Mapping auf UCUM
switch(uom) {
case 'urn:adv:uom:m2':
	result = 'm2'
	break
case 'urn:adv:uom:m':
	result = 'm'
	break
case 'urn:adv:uom:km':
	result = 'km'
	break
}

if (!result) {
	// Transformations-Warnung falls kein Mapping auf UCUM vorhanden
	_log.warn("Unknown UCUM representation for unit of measurment $uom, using code as-is")
	result = uom
}

result
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Abbildung von Maßeinheiten aus AdV URNs nach UCUM

*Keine vollständige Abbildung, muss ggf. ergänzt werden.*

Aktuell ist folgende Abbildung umgesetzt:

- `urn:adv:uom:m2` zu `m2`
- `urn:adv:uom:m`zu `m`

</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C33b5349d-fb85-4c7d-8519-ac27e4c49867" priority="highest">
        <source>
            <class>
                <type name="ax_bauwerkimgewaesserbereich" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="AbstractFeatureType" ns="http://www.opengis.net/gml/3.2"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def bwf = _source.p.bauwerksfunktion.value()
def identifier = _source.p.gml_id.value()

withTransformationContext {
  def collect = _.context.collector(it)
  
  // Bauwerksfunktion zu Identifier des Objekts im Index ablegen
  collect.bauwerksfunktion[identifier] = bwf
}
</core:text>
        </complexParameter>
        <documentation>Dies ist eine Dummy-Transformationsdefinition die keine Objekte erzeugt sondern zum Aufbauen eines Index für die Bauwerksfunktion von `AX_BauwerkImGewaesserbereich` dient.
Diese Information wird herangezogen um entsprechend für REO-Objekte über die Beziehung `hatDirektUnten` den entsprechenden Wert für die *TransportProperty* `VerticalPosition` zu bestimmen.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C43232927-f863-47e3-b297-dd8902f4bbc7" priority="highest">
        <source>
            <class>
                <type name="ax_bauwerkimverkehrsbereich" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="AbstractFeatureType" ns="http://www.opengis.net/gml/3.2"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def bwf = _source.p.bauwerksfunktion.value()
def identifier = _source.p.gml_id.value()

withTransformationContext {
  def collect = _.context.collector(it)
  
  // Bauwerksfunktion zu Identifier des Objekts im Index ablegen
  collect.bauwerksfunktion[identifier] = bwf
}
</core:text>
        </complexParameter>
        <documentation>Dies ist eine Dummy-Transformationsdefinition die keine Objekte erzeugt sondern zum Aufbauen eines Index für die Bauwerksfunktion von `AX_BauwerkImVerkehrsbereich` dient.
Diese Information wird herangezogen um entsprechend für REO-Objekte über die Beziehung `hatDirektUnten` den entsprechenden Wert für die *TransportProperty* `VerticalPosition` zu bestimmen.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C1eb2d011-34d1-4077-8388-f7fbdb1659b9" priority="low">
        <target>
            <class>
                <type name="ConditionOfFacilityType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Die Code-Liste für ConditionOfFacility
def codeList = 'http://inspire.ec.europa.eu/codelist/ConditionOfFacilityValue'

def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein ConditionOfFacility-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.conditionOfFacility.consume { key, values -&gt;
	def _id = 'ConditionOfFacility_' + _project.vars.THEME_DISTINGUISHER + '_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		currentStatus {
			href( "$codeList/$key" )
		}
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `ConditionOfFacility`-Objekt für jeden in den Daten vorkommenden Wert der [ConditionOfFacilityValue Code-Liste](http://inspire.ec.europa.eu/codelist/ConditionOfFacilityValue).

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Code-Listen Wert gebildet, z.B. `ConditionOfFacility_functional`.

Es werden Referenzen (`NetworkReference`) zu allen Netzwerk-Elementen (z.B. *TransportLinks* und *TransportAreas*) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C1eb2d011-34d1-4077-8388-f7fbdb1659b9" priority="normal">
        <target>
            <property>
                <type name="ConditionOfFacilityType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C1eb2d011-34d1-4077-8388-f7fbdb1659b9" priority="normal">
        <target>
            <property>
                <type name="ConditionOfFacilityType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="Cbc1d0004-f009-40ce-a9e0-284e0852cbd0" priority="low">
        <target>
            <class>
                <type name="NominalTrackGaugeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein NominalTrackGauge-Objekt für jeden vorkommenden Wert
collect.nominalTrackGauge.consume { key, values -&gt;
	def _id = 'NominalTrackGauge_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		if (key == 'standard') {
			// Spurweite ist nur für standard bekannt
			nominalGauge( '1435' ) {
				uom( 'mm' )
			}
		}
		else {
			nominalGauge {
				nilReason( 'unknown' )
				uom( 'mm' )
			}
		}
		nominalGaugeCategory{
			href( 'http://inspire.ec.europa.eu/codelist/TrackGaugeCategoryValue/' + key )
		}
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Objekten mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `NominalTrackGauge`-Objekt für jeden in den Daten vorkommenden Wert für `nominalGaugeCategory`.

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Wert gebildet, z.B. `NominalTrackGauge_standard`.

Es werden Referenzen (NetworkReference) zu allen Netzwerk-Elementen (z.B. `RailwayLink`) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_Cbc1d0004-f009-40ce-a9e0-284e0852cbd0" priority="normal">
        <target>
            <property>
                <type name="NominalTrackGaugeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_Cbc1d0004-f009-40ce-a9e0-284e0852cbd0" priority="normal">
        <target>
            <property>
                <type name="NominalTrackGaugeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C6f5276f4-be5d-4509-a927-a39aea98844a" priority="low">
        <target>
            <class>
                <type name="NumberOfTracksType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein NumberOfTracks-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.numberOfTracks.consume { key, values -&gt;
	def _id = 'NumberOfTracks_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		numberOfTracks( key )
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `NumberOfTracks`-Objekt für jeden in den Daten vorkommenden Wert für `numberOfTracks`.

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Wert gebildet.

Es werden Referenzen (NetworkReference) zu allen Netzwerk-Elementen (z.B.  `RailwayLink`) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C6f5276f4-be5d-4509-a927-a39aea98844a" priority="normal">
        <target>
            <property>
                <type name="NumberOfTracksType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Ca5062864-f188-41e7-a800-dc412d36911d" priority="normal">
        <target>
            <property>
                <type name="NumberOfTracksType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="minMaxNumberOfTracks" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C6f5276f4-be5d-4509-a927-a39aea98844a" priority="normal">
        <target>
            <property>
                <type name="NumberOfTracksType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="Cbdf5128c-1dad-4827-806e-ee6a6fc3cc50" priority="normal">
        <source>
            <class>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

def _id = 'RailwayArea_' + _source.p.gml_id.value() 

_target {
}

// bestimme RailwayType(s)
def railwayTypes = []
_source.p.bahnkategorie.each { bkt -&gt;
	switch (bkt as String) {
	case '1100': // Eisenbahn
	case '1101': // Personenverkehr
	case '1102': // Güterverkehr
	case '1103': // Betriebsverkehr
	case '1104': // S-Bahn
	case '1400': // Museumsbahn
	case '1500': // Bahn im Freizeitpark
		railwayTypes &lt;&lt; 'train'
		break
	case '1200': // Stadtbahn
	case '1202': // U-Bahn
		railwayTypes &lt;&lt; 'metro'
		break
	case '1201': // Straßenbahn
		railwayTypes &lt;&lt; 'tramway'
		break
	case '1300': // Seilbahn, Bergbahn
	case '1302': // Standseilbahn
		railwayTypes &lt;&lt; 'funicular'
		break
	case '1301': // Zahnradbahn
		railwayTypes &lt;&lt; 'cogRailway'
		break
	case '1600': // Magnetschwebebahn
		railwayTypes &lt;&lt; 'magneticLevitation'
		break
	}
}

// bestimme ConditionOfFacility
def conditionOfFacility = 'functional'
switch (_source.p.zustand.value() as String) {
case '2100': // Außer Betrieb, stillgelegt, verlassen
	conditionOfFacility = 'disused'
	break
case '4000': // Im Bau
	conditionOfFacility = 'underConstruction'
	break
case '8000': // Im Bau
	conditionOfFacility = 'projected'
	break
}

/*
 * Sammeln von Informationen bzgl. hatDirektUnten für VerticalPosition
 */
def untenRefs = _source.p.hatdirektunten.values()
def verticalPositions = untenRefs.findResults { identifier -&gt;
	def bwf = collect.bauwerksfunktion[identifier].value() as String
	if (bwf) {
		switch (bwf) {
		// AX_BauwerkImVerkehrsbereich
		case '1800': // Brücke
		case '1801': // Mehrstöckige Brücke
		case '1802': // Bogenbrücke
		case '1803': // Fachwerkbrücke
		case '1804': // Hängebrücke
		case '1805': // Pontonbrücke
		case '1806': // Drehbrücke
		case '1807': // Hebebrücke
		case '1808': // Zugbrücke
		case '1820': // Steg
		case '1830': // Hochbahn, Hochstraße
		case '1890': // Schleusenkammer
		// AX_BauwerkImGewaesserbereich
		case '2030': // Staumauer
		case '2040': // Staudamm
		case '2050': // Wehr
		case '2060': // Sicherheitstor
		case '2080': // Sperrwerk
			return 'suspendedOrElevated'
		// AX_BauwerkImVerkehrsbereich
		case '1870': // Tunnel, Unterführung
		// AX_BauwerkImGewaesserbereich
		case '2010': // Durchlass
		case '2011': // Rohrdurchlass
		case '2012': // Düker
		case '2070': // Siel
		case '2090': // Schöpfwerk
			return 'underground'
		}
	}
	else {
		null
	}
} as Set
def verticalPosition
if (!verticalPositions) {
	verticalPosition = 'onGroundSurface'
}
else {
	verticalPosition = verticalPositions.iterator().next()
	if (verticalPositions.size() &gt; 1) {
		_log.error('Multiple different values for vertical position of an object: ' + verticalPositions)
	}
}

// Sammle ID für Netzwerk
collect.network &lt;&lt; _id
// Sammle ID für RailwayType(s)
railwayTypes.each { railwayType -&gt;
	collect.railwayType[railwayType] &lt;&lt; _id
}
// Sammle ID für ConditionOfFacility
collect.conditionOfFacility[conditionOfFacility] &lt;&lt; _id
// Sammle ID für VerticalPosition
collect.verticalPosition[verticalPosition] &lt;&lt; _id
</core:text>
        </complexParameter>
        <documentation>Erstellt eine `RailwayArea` aus einem `AX_Bahnverkehr`.

Die erstellte `RailwayArea` wird dem Index von Netzwerk-Elementen hinzugefügt.

Zusätzlich werden folgende Informationen in den entsprechenden Indizes abgelegt:

**RailwayType**

Der `railwayType` wird wie folgt aus dem Attribute `bahnkategorie` ermittelt:

bahnkategorie | railwayType
- | -
`1100` *(Eisenbahn)* | `train`
`1102` *(Güterverkehr)* | `train`
`1104` *(S-Bahn)* | `train`
`1400` *(Museumsbahn)* | `train`
`1500` *(Bahn im Freizeitpark)* | `train`
`1200` *(Stadtbahn)* | `metro`
`1202` *(U-Bahn)* | `metro`
`1201` *(Straßenbahn)* | `tramway`
`1300` *(Seilbahn, Bergbahn)* | `funicular`
`1302` *(Standseilbahn)* | `funicular`
`1301` *(Zahnradbahn)* | `cogRailway`
`1600` *(Magnetschwebebahn)* | `magneticLevitation`

**ConditionOfFacility**

Die *conditionOfFacility* wird wie folgt aus dem Attribut `zustand` ermittelt:

zustand | conditionOfFacility
- | -
`2100` *(Außer Betrieb, stillgelegt, verlassen)* | `disused`
`4000` *(Im Bau)* | `underConstruction`

In allen anderen Fällen wird *conditionOfFacility* als `functional` angenommen.

**VerticalPosition**

Die *verticalPosition* wird über das Attribut `hatDirektUnten` ermittelt.
Referenzen auf `AX_BauwerkImVerkehrsbereich` und `AX_BauwerkImGewaesserbereich` werden über einen Index nachgeschlagen um die entsprechende `bauwerksfunktion` zu erhalten.
Aus der `bauwerksfunktion` wird der Wert wie folgt ermittelt:

bauwerksfunktion | verticalPosition
- | -
`1800` *(Brücke)* | `suspendedOrElevated`
`1801` *(Mehrstöckige Brücke)* | `suspendedOrElevated`
`1802` *(Bogenbrücke)* | `suspendedOrElevated`
`1803` *(Fachwerkbrücke)* | `suspendedOrElevated`
`1804` *(Hängebrücke)* | `suspendedOrElevated`
`1805` *(Pontonbrücke)* | `suspendedOrElevated`
`1806` *(Drehbrücke)* | `suspendedOrElevated`
`1807` *(Hebebrücke)* | `suspendedOrElevated`
`1808` *(Zugbrücke)* | `suspendedOrElevated`
`1820` *(Steg)* | `suspendedOrElevated`
`1830` *(Hochbahn, Hochstraße)* | `suspendedOrElevated`
`1890` *(Schleusenkammer)* | `suspendedOrElevated`
`2030` *(Staumauer)* | `suspendedOrElevated`
`2040` *(Staudamm)* | `suspendedOrElevated`
`2050` *(Wehr)* | `suspendedOrElevated`
`2060` *(Sicherheitstor)* | `suspendedOrElevated`
`2080` *(Sperrwerk)* | `suspendedOrElevated`
`1870` *(Tunnel, Unterführung)* | `underground`
`2010` *(Durchlass)* | `underground`
`2011` *(Rohrdurchlass)* | `underground`
`2012` *(Düker)* | `underground`
`2070` *(Siel)* | `underground`
`2090` *(Schöpfwerk)* | `underground`

Für alle anderen `bauwerksfunktion`en, Referenzen auf andere Objekte oder auch bei Nicht-Vorhandensein von Referenzen wird der Wert `onGroundSurface` angenommen. Bei mehreren verschiedenen Referenzen haben `suspendedOrElevated` und `underground` Vorrang vor `onGroundSurface`.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C48d3be90-5843-4323-bd79-ba1928b2429e_Cbdf5128c-1dad-4827-806e-ee6a6fc3cc50" priority="normal">
        <source>
            <property>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C92d71e60-b3b7-4864-a6a2-fc6d46d9ac4c_Cbdf5128c-1dad-4827-806e-ee6a6fc3cc50" priority="normal">
        <source>
            <property>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C4d69e8d8-0f66-4fb1-9343-465ee5604ff3" priority="normal">
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.geometry.simplefeature" id="C2415887f-d793-4ea9-be9a-5401165c7541" priority="normal">
        <source name="geometrie">
            <property>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
                <child name="wkb_geometry"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geometry" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Cab81ca0e-f1a1-4311-aeb5-379d03826e51" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="Ce5d5030b-02c9-4cce-8c2e-0da8d0a0303b" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C03716a0b-a2f7-4f4b-8d93-13d186c7af73_Cbdf5128c-1dad-4827-806e-ee6a6fc3cc50" priority="normal">
        <target name="result">
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inNetwork" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">'#' + _project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Verknüpft das Netzwerk-Element mit dem entsprechenden *TransportNetwork*.
Dazu wird die vorgegebene ID für das Netzwerk verwendet (Projekt-Variable).</documentation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C825ec2fa-a425-41b9-a8af-d4d014d0de57" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnverkehr" ns="jdbc:postgresql:testbed:public"/>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C565ee942-8f6f-4e42-b213-23337a892129" priority="normal">
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C1d0cdc85-bd58-42ce-9698-9f42683e2d58" priority="normal">
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cdc70ecf5-b963-44da-80b4-854b89fa7440" priority="normal">
        <target>
            <property>
                <type name="RailwayAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C26cdc371-11f7-4d7d-990e-555c63de147b" priority="low">
        <target>
            <class>
                <type name="RailwayElectrificationType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein RailwayElectrification-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.electrified.consume { key, values -&gt;
	def _id = 'RailwayElectrification_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		electrified( key )
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `RailwayElectrification`-Objekt für jeden in den Daten vorkommenden Wert für `electrified`.

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Wert gebildet.

Es werden Referenzen (NetworkReference) zu allen Netzwerk-Elementen (z.B.  `RailwayLink`) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C26cdc371-11f7-4d7d-990e-555c63de147b" priority="normal">
        <target>
            <property>
                <type name="RailwayElectrificationType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C26cdc371-11f7-4d7d-990e-555c63de147b" priority="normal">
        <target>
            <property>
                <type name="RailwayElectrificationType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.merge" id="Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source>
            <class>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
            </class>
        </source>
        <target>
            <class>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <parameter value="name" name="additional_property"/>
        <parameter value="false" name="auto_detect"/>
        <parameter value="nummerderbahnstrecke" name="property"/>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
_target {
}

// ID zum hinterlegen in Indizes bestimmen

// alle Quell-IDs als Liste
def identifiers = _source.p.gml_id.values()

def _id

if (identifiers.size() == 1) {
  // verwende Original-ID falls nur eine Quelle
  _id = 'RailwayLine_' + identifiers[0]
}
else {
  // sortieren (TODO spezielle Ordnung benötigt?)
  identifiers = identifiers.sort()

  def identString = identifiers.join()

  _id = 'RailwayLine_' + _.crypto.sha256(identString)
}


withTransformationContext {
	def collect = _.context.collector(it)
	// Sammle ID für Netzwerk
	collect.network &lt;&lt; _id
}
</core:text>
        </complexParameter>
        <documentation>Erstellt `RailwayLine`s aus `AX_Bahnstrecke`n mit gleicher `nummerDerBahnstrecke`.

Die erstellte `RailwayLine` wird dem Index von Netzwerk-Elementen hinzugefügt.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.date.earliest" id="Ccef52db8-7149-4567-bfc0-a777865aa5b4_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="dates">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C48d3be90-5843-4323-bd79-ba1928b2429e_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source>
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.date.earliest" id="C5a51591e-2db2-4e05-a6c4-d01b59122d91_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="dates">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C92d71e60-b3b7-4864-a6a2-fc6d46d9ac4c_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source>
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="C82626e7b-d27c-44b0-8821-6a49db42400a_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="spelling">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="name"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C80652f08-0840-40b1-b701-c4eb5b4e2856" priority="normal">
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unknown" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C39cd808f-36de-4888-ae0f-d56a457636fa_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="C3cd86c2c-be9e-45f3-a85d-2f9fa24f0f54_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C03716a0b-a2f7-4f4b-8d93-13d186c7af73_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <target name="result">
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inNetwork" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">'#' + _project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Verknüpft das Netzwerk-Element mit dem entsprechenden *TransportNetwork*.
Dazu wird die vorgegebene ID für das Netzwerk verwendet (Projekt-Variable).</documentation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Cd19e2f21-33e0-426b-af74-dc2cd251c1da_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C219ed724-f214-45a8-b291-5272fd866b99" priority="normal">
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.formattedstring" id="Cf0ca6058-fbaf-4604-a265-5c7f3d2ade2a_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source name="var">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="link" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="#RailwayLink_{gml_id}" name="pattern"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C0047cb98-5745-4d80-9ea9-5785af1a3809" priority="normal">
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="post" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="Cc8f197c0-2249-4a5e-956f-85addea8eb55_Ca500e629-76b0-4cda-b53f-c9db0c272403" priority="normal">
        <source>
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (nummerderbahnstrecke IS NULL)</condition>
                </type>
                <child name="nummerderbahnstrecke"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="railwayLineCode" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cd99f8fb6-fc49-4a92-85bd-059d1e7deb42" priority="normal">
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C688e237c-ab7e-4be7-8d06-0e366460c193" priority="normal">
        <target>
            <property>
                <type name="RailwayLineType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C19325fbe-66ff-4f83-9c63-947af27dc065" priority="normal">
        <source>
            <class>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

_target {
}

// bestimme NominalTrackGauge
def nominalTrackGauge
switch (_source.p.spurweite.value() as String) {
case '1000': // Normalspur (Regelspur, Vollspur)
	nominalTrackGauge = 'standard'
	break
case '2000': // Schmalspur
	nominalTrackGauge = 'narrow'
	break
case '3000': // Breitspur
	nominalTrackGauge = 'broad'
	break
}

// bestimme RailwayType(s)
def railwayTypes = []
_source.p.bahnkategorie.each { bkt -&gt;
	switch (bkt as String) {
	case '1100': // Eisenbahn
	case '1101': // Personenverkehr
	case '1102': // Güterverkehr
	case '1104': // S-Bahn
	case '1400': // Museumsbahn
	case '1500': // Bahn im Freizeitpark
		railwayTypes &lt;&lt; 'train'
		break
	case '1200': // Stadtbahn
	case '1202': // U-Bahn
		railwayTypes &lt;&lt; 'metro'
		break
	case '1201': // Straßenbahn
		railwayTypes &lt;&lt; 'tramway'
		break
	case '1300': // Seilbahn, Bergbahn
	case '1302': // Standseilbahn
		railwayTypes &lt;&lt; 'funicular'
		break
	case '1301': // Zahnradbahn
		railwayTypes &lt;&lt; 'cogRailway'
		break
	case '1600': // Magnetschwebebahn
		railwayTypes &lt;&lt; 'magneticLevitation'
		break
	}
}

// bestimme RailwayUse(s)
def railwayUses = []
_source.p.bahnkategorie.each { bkt -&gt;
	switch (bkt as String) {
	case '1100': // Eisenbahn
	case '1300': // Seilbahn, Bergbahn
	case '1302': // Standseilbahn
	case '1301': // Zahnradbahn
		railwayUses &lt;&lt; 'mixed'
		break
	case '1102': // Güterverkehr
		railwayUses &lt;&lt; 'cargo'
		break
	case '1101': // Personenverkehr	
	case '1104': // S-Bahn
	case '1200': // Stadtbahn
	case '1201': // Straßenbahn
	case '1202': // U-Bahn
	case '1400': // Museumsbahn
	case '1500': // Bahn im Freizeitpark
	case '1600': // Magnetschwebebahn
		railwayUses &lt;&lt; 'passengers'
		break
	}
}

// bestimme NumberOfTracks
def numberOfTracks
switch (_source.p.anzahlDerStreckengleise.value() as String) {
case '1000': // Eingleisig
	numberOfTracks = 1
	break
case '2000': // Zweigleisig
	numberOfTracks = 2
	break
}

// bestimme RailwayElectrification
def electrified = (_source.p.elektrifizierung.value() as String) != '2000'

// bestimme ConditionOfFacility
def conditionOfFacility = 'functional'
switch (_source.p.zustand.value() as String) {
case '2100': // Außer Betrieb, stillgelegt, verlassen
	conditionOfFacility = 'disused'
	break
case '4000': // Im Bau
	conditionOfFacility = 'underConstruction'
	break
}

/*
 * Sammeln von Informationen bzgl. hatDirektUnten für VerticalPosition
 */
def untenRefs = _source.p.hatdirektunten.values()
def verticalPositions = untenRefs.findResults { identifier -&gt;
	def bwf = collect.bauwerksfunktion[identifier].value() as String
	if (bwf) {
		switch (bwf) {
		// AX_BauwerkImVerkehrsbereich
		case '1800': // Brücke
		case '1801': // Mehrstöckige Brücke
		case '1802': // Bogenbrücke
		case '1803': // Fachwerkbrücke
		case '1804': // Hängebrücke
		case '1805': // Pontonbrücke
		case '1806': // Drehbrücke
		case '1807': // Hebebrücke
		case '1808': // Zugbrücke
		case '1820': // Steg
		case '1830': // Hochbahn, Hochstraße
		case '1890': // Schleusenkammer
		// AX_BauwerkImGewaesserbereich
		case '2030': // Staumauer
		case '2040': // Staudamm
		case '2050': // Wehr
		case '2060': // Sicherheitstor
		case '2080': // Sperrwerk
			return 'suspendedOrElevated'
		// AX_BauwerkImVerkehrsbereich
		case '1870': // Tunnel, Unterführung
		// AX_BauwerkImGewaesserbereich
		case '2010': // Durchlass
		case '2011': // Rohrdurchlass
		case '2012': // Düker
		case '2070': // Siel
		case '2090': // Schöpfwerk
			return 'underground'
		}
	}
	else {
		null
	}
} as Set
def verticalPosition
if (!verticalPositions) {
	verticalPosition = 'onGroundSurface'
}
else {
	verticalPosition = verticalPositions.iterator().next()
	if (verticalPositions.size() &gt; 1) {
		_log.error('Multiple different values for vertical position of an object: ' + verticalPositions)
	}
}

// ID zum hinterlegen in Indizes
def sourceId = _source.p.gml_id.value()
def _id = "RailwayLink_${sourceId}"

// Sammle ID für Netzwerk
collect.network &lt;&lt; _id
// Sammle ID für NominalTrackGauge
if (nominalTrackGauge) {
	collect.nominalTrackGauge[nominalTrackGauge] &lt;&lt; _id
}
// Sammle ID für RailwayType(s)
railwayTypes.each { railwayType -&gt;
	collect.railwayType[railwayType] &lt;&lt; _id
}
// Sammle ID für RailwayUse(s)
railwayUses.each { railwayUse -&gt;
	collect.railwayUse[railwayUse] &lt;&lt; _id
}
// Sammle ID für NumberOfTracks
if (numberOfTracks) {
	collect.numberOfTracks[numberOfTracks] &lt;&lt; _id
}
// Sammle ID für RailwayElectrification
collect.electrified[electrified] &lt;&lt; _id
// Sammle ID für ConditionOfFacility
collect.conditionOfFacility[conditionOfFacility] &lt;&lt; _id
// Sammle ID für VerticalPosition
collect.verticalPosition[verticalPosition] &lt;&lt; _id
</core:text>
        </complexParameter>
        <documentation>Erstellt einen `RailwayLink` aus einer `AX_Bahnstrecke`.

Der erstellte `RailwayLink` wird dem Index von Netzwerk-Elementen hinzugefügt.

Zusätzlich werden folgende Informationen in den entsprechenden Indizes abgelegt:

**NominalTrackGauge**

Die `nominalGaugeCategory` wird wie folgt aus dem Attribut `spurweite` ermittelt:

spurweite  | nominalGaugeCategory
- | -
`1000` *(Normalspur (Regelspur, Vollspur))* | `standard`
`2000` *(Schmalspur)* | `narrow`
`3000` *(Breitspur)* | `broad`

**RailwayType**

Der `railwayType` wird wie folgt aus dem Attribute `bahnkategorie` ermittelt:

bahnkategorie | railwayType
- | -
`1100` *(Eisenbahn)* | `train`
`1102` *(Güterverkehr)* | `train`
`1104` *(S-Bahn)* | `train`
`1400` *(Museumsbahn)* | `train`
`1500` *(Bahn im Freizeitpark)* | `train`
`1200` *(Stadtbahn)* | `metro`
`1202` *(U-Bahn)* | `metro`
`1201` *(Straßenbahn)* | `tramway`
`1300` *(Seilbahn, Bergbahn)* | `funicular`
`1302` *(Standseilbahn)* | `funicular`
`1301` *(Zahnradbahn)* | `cogRailway`
`1600` *(Magnetschwebebahn)* | `magneticLevitation`

**RailwayUse**

Die `railwayUse` wird wie folgt aus dem Attribute `bahnkategorie` bestimmt:

bahnkategorie | railwayUse
- | -
`1100` *(Eisenbahn)* | `mixed`
`1300` *(Seilbahn, Bergbahn)* | `mixed`
`1302` *(Standseilbahn)* | `mixed`
`1301` *(Zahnradbahn)* | `mixed`
`1102` *(Güterverkehr)* | `cargo`
`1104` *(S-Bahn)* | `passengers`
`1200` *(Stadtbahn)* | `passengers`
`1201` *(Straßenbahn)* | `passengers`
`1202` *(U-Bahn)* | `passengers`
`1400` *(Museumsbahn)* | `passengers`
`1500` *(Bahn im Freizeitpark)* | `passengers`
`1600` *(Magnetschwebebahn)* | `passengers`

**NumberOfTracks**

Die `numberOfTracks` wird wie folgt aus dem Attribut `anzahlDerStreckengleise` bestimmt:

anzahlDerStreckengleise | numberOfTracks
- | -
`1000` *(Eingleisig)* | `1`
`2000` *(Zweigleisig)* | `2`

**RailwayElectrification**

Ob ein `RailwayLink` elektrifiziert (`electrified`) ist wird aus dem Attribut `elektrifizierung` bestimmt. Er ist nicht elektrifiziert falls das Attribute den Wert `2000` (Nicht elektrifiziert) hat.

**ConditionOfFacility**

Die *conditionOfFacility* wird wie folgt aus dem Attribut `zustand` ermittelt:

zustand | conditionOfFacility
- | -
`2100` *(Außer Betrieb, stillgelegt, verlassen)* | `disused`
`4000` *(Im Bau)* | `underConstruction`

In allen anderen Fällen wird *conditionOfFacility* als `functional` angenommen.

**VerticalPosition**

Die *verticalPosition* wird über das Attribut `hatDirektUnten` ermittelt.
Referenzen auf `AX_BauwerkImVerkehrsbereich` und `AX_BauwerkImGewaesserbereich` werden über einen Index nachgeschlagen um die entsprechende `bauwerksfunktion` zu erhalten.
Aus der `bauwerksfunktion` wird der Wert wie folgt ermittelt:

bauwerksfunktion | verticalPosition
- | -
`1800` *(Brücke)* | `suspendedOrElevated`
`1801` *(Mehrstöckige Brücke)* | `suspendedOrElevated`
`1802` *(Bogenbrücke)* | `suspendedOrElevated`
`1803` *(Fachwerkbrücke)* | `suspendedOrElevated`
`1804` *(Hängebrücke)* | `suspendedOrElevated`
`1805` *(Pontonbrücke)* | `suspendedOrElevated`
`1806` *(Drehbrücke)* | `suspendedOrElevated`
`1807` *(Hebebrücke)* | `suspendedOrElevated`
`1808` *(Zugbrücke)* | `suspendedOrElevated`
`1820` *(Steg)* | `suspendedOrElevated`
`1830` *(Hochbahn, Hochstraße)* | `suspendedOrElevated`
`1890` *(Schleusenkammer)* | `suspendedOrElevated`
`2030` *(Staumauer)* | `suspendedOrElevated`
`2040` *(Staudamm)* | `suspendedOrElevated`
`2050` *(Wehr)* | `suspendedOrElevated`
`2060` *(Sicherheitstor)* | `suspendedOrElevated`
`2080` *(Sperrwerk)* | `suspendedOrElevated`
`1870` *(Tunnel, Unterführung)* | `underground`
`2010` *(Durchlass)* | `underground`
`2011` *(Rohrdurchlass)* | `underground`
`2012` *(Düker)* | `underground`
`2070` *(Siel)* | `underground`
`2090` *(Schöpfwerk)* | `underground`

Für alle anderen `bauwerksfunktion`en, Referenzen auf andere Objekte oder auch bei Nicht-Vorhandensein von Referenzen wird der Wert `onGroundSurface` angenommen. Bei mehreren verschiedenen Referenzen haben `suspendedOrElevated` und `underground` Vorrang vor `onGroundSurface`.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <class>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">bahnkategorie = '2500'</condition>
                </type>
            </class>
        </source>
        <target>
            <class>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// nur Objekt mit linienartigen Geometrien behandeln
def geometries = _.geom.findLines(_source.p.wkb_geometry.value())

// Ziel unterstützt keine MultiLineStrings
def curves = _.geom.toSimpleGeometries(geometries: geometries, collections: false)

// Builder konfigurieren
// - Zuweisung der Geometrie auf Ebene von geometry zulassen
_b.strictValueFlags = false

def sourceId = _source.p.gml_id.value()

// bestimme RailwayType
def railwayType = 'suspendedRail'

/*
 * Sammeln von Informationen bzgl. hatDirektUnten für VerticalPosition
 */
def untenRefs = _source.p.hatdirektunten.values()
def verticalPositions = untenRefs.findResults { identifier -&gt;
	def bwf = collect.bauwerksfunktion[identifier].value() as String
	if (bwf) {
		switch (bwf) {
		// AX_BauwerkImVerkehrsbereich
		case '1800': // Brücke
		case '1801': // Mehrstöckige Brücke
		case '1802': // Bogenbrücke
		case '1803': // Fachwerkbrücke
		case '1804': // Hängebrücke
		case '1805': // Pontonbrücke
		case '1806': // Drehbrücke
		case '1807': // Hebebrücke
		case '1808': // Zugbrücke
		case '1820': // Steg
		case '1830': // Hochbahn, Hochstraße
		case '1890': // Schleusenkammer
		// AX_BauwerkImGewaesserbereich
		case '2030': // Staumauer
		case '2040': // Staudamm
		case '2050': // Wehr
		case '2060': // Sicherheitstor
		case '2080': // Sperrwerk
			return 'suspendedOrElevated'
		// AX_BauwerkImVerkehrsbereich
		case '1870': // Tunnel, Unterführung
		// AX_BauwerkImGewaesserbereich
		case '2010': // Durchlass
		case '2011': // Rohrdurchlass
		case '2012': // Düker
		case '2070': // Siel
		case '2090': // Schöpfwerk
			return 'underground'
		}
	}
	else {
		null
	}
} as Set
def verticalPosition
if (!verticalPositions) {
	verticalPosition = 'onGroundSurface'
}
else {
	verticalPosition = verticalPositions.iterator().next()
	if (verticalPositions.size() &gt;= 1) {
		_log.error('Multiple different values for vertical position of an object: ' + verticalPositions)
	}
}

// Ziel-Objekt für jede Linie erstellen
int num = 1
curves.each { curve -&gt;
	// ID bestimmen
	def _id = "RailwayLink_${sourceId}_${num}"
	def _ns = _project.vars.INSPIRE_NAMESPACE

	// Ziel-Objekt erstellen
	_target {
		id( _id )
		inspireId {
			Identifier {
				localId( _id )
				namespace( _ns )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		centrelineGeometry(curve)
	}
	
	// Sammle ID für Netzwerk	
	collect.network &lt;&lt; _id
	// Sammle ID für RailwayType
	collect.railwayType[railwayType] &lt;&lt; _id
	// Sammle ID für VerticalPosition
	collect.verticalPosition[verticalPosition] &lt;&lt; _id
	
	num++
}
</core:text>
        </complexParameter>
        <documentation>Erstellt `RailwayLink` aus einer `AX_SeilbahnSchwebebahn` (nur `bahnkategorie` *Schwebebahn*).

Die Geometrie des Quell-Objekts wird untersucht. Nur linienartige Geometrien werden verwendet. Je individueller Geometrie wird ein `RailwayLink` erzeugt.

Die lokale ID wird aus dem Namen der Ziel-Objektart, der AAA-ObjektID des Quell-Objekts und einer aufsteigenden Nummer der individuellen Geometrien (1., 2., Geometrie) gebildet.

Die erstellten `RailwayLink`s werden dem Index von Netzwerk-Elementen hinzugefügt.

Zusätzlich werden folgende Informationen in den entsprechenden Indizes abgelegt:

**RailwayType**

Der *railwayType* wird als `suspendedRail` festgelegt.

**VerticalPosition**

Die *verticalPosition* wird über das Attribut `hatDirektUnten` ermittelt.
Referenzen auf `AX_BauwerkImVerkehrsbereich` und `AX_BauwerkImGewaesserbereich` werden über einen Index nachgeschlagen um die entsprechende `bauwerksfunktion` zu erhalten.
Aus der `bauwerksfunktion` wird der Wert wie folgt ermittelt:

bauwerksfunktion | verticalPosition
- | -
`1800` *(Brücke)* | `suspendedOrElevated`
`1801` *(Mehrstöckige Brücke)* | `suspendedOrElevated`
`1802` *(Bogenbrücke)* | `suspendedOrElevated`
`1803` *(Fachwerkbrücke)* | `suspendedOrElevated`
`1804` *(Hängebrücke)* | `suspendedOrElevated`
`1805` *(Pontonbrücke)* | `suspendedOrElevated`
`1806` *(Drehbrücke)* | `suspendedOrElevated`
`1807` *(Hebebrücke)* | `suspendedOrElevated`
`1808` *(Zugbrücke)* | `suspendedOrElevated`
`1820` *(Steg)* | `suspendedOrElevated`
`1830` *(Hochbahn, Hochstraße)* | `suspendedOrElevated`
`1890` *(Schleusenkammer)* | `suspendedOrElevated`
`2030` *(Staumauer)* | `suspendedOrElevated`
`2040` *(Staudamm)* | `suspendedOrElevated`
`2050` *(Wehr)* | `suspendedOrElevated`
`2060` *(Sicherheitstor)* | `suspendedOrElevated`
`2080` *(Sperrwerk)* | `suspendedOrElevated`
`1870` *(Tunnel, Unterführung)* | `underground`
`2010` *(Durchlass)* | `underground`
`2011` *(Rohrdurchlass)* | `underground`
`2012` *(Düker)* | `underground`
`2070` *(Siel)* | `underground`
`2090` *(Schöpfwerk)* | `underground`

Für alle anderen `bauwerksfunktion`en, Referenzen auf andere Objekte oder auch bei Nicht-Vorhandensein von Referenzen wird der Wert `onGroundSurface` angenommen. Bei mehreren verschiedenen Referenzen haben `suspendedOrElevated` und `underground` Vorrang vor `onGroundSurface`.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C48d3be90-5843-4323-bd79-ba1928b2429e_C19325fbe-66ff-4f83-9c63-947af27dc065" priority="normal">
        <source>
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C48d3be90-5843-4323-bd79-ba1928b2429e_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">bahnkategorie = '2500'</condition>
                </type>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="custom:alignment:adv.geometry.simplefeature" id="C3db7a167-d20a-482b-8b61-ce70f573de62" priority="normal">
        <source name="geometrie">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="wkb_geometry"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="centrelineGeometry" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C92d71e60-b3b7-4864-a6a2-fc6d46d9ac4c_C19325fbe-66ff-4f83-9c63-947af27dc065" priority="normal">
        <source>
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C92d71e60-b3b7-4864-a6a2-fc6d46d9ac4c_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">bahnkategorie = '2500'</condition>
                </type>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cf78462fb-2cc3-4337-b4b6-4bc3e6485717" priority="normal">
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="fictitious" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="C79a194e1-23b0-4f14-81f7-8b0871a857c6" priority="normal">
        <source name="spelling">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="name"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="C5ee0f9dd-3579-4712-a379-af803911bc0e_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source name="spelling">
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">bahnkategorie = '2500'</condition>
                </type>
                <child name="name"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C5ee3e63c-f81e-482a-8c6e-d390db597620" priority="normal">
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unknown" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="Ce4468419-2542-4c90-a98f-02a3807111d8" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.identifier" id="Ca7a866af-7d66-4d7a-9a25-ae2d39fca517" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C03716a0b-a2f7-4f4b-8d93-13d186c7af73_C19325fbe-66ff-4f83-9c63-947af27dc065" priority="normal">
        <target name="result">
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inNetwork" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">'#' + _project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Verknüpft das Netzwerk-Element mit dem entsprechenden *TransportNetwork*.
Dazu wird die vorgegebene ID für das Netzwerk verwendet (Projekt-Variable).</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C03716a0b-a2f7-4f4b-8d93-13d186c7af73_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <target name="result">
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inNetwork" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">'#' + _project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Verknüpft das Netzwerk-Element mit dem entsprechenden *TransportNetwork*.
Dazu wird die vorgegebene ID für das Netzwerk verwendet (Projekt-Variable).</documentation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.id.default" id="C53e1aa42-b908-4f45-8224-2a82d2a5a54f" priority="normal">
        <source name="id">
            <property>
                <type name="ax_bahnstrecke" ns="jdbc:postgresql:testbed:public"/>
                <child name="gml_id"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C4bcaaeda-f8c5-41c5-8efa-bc3a2eaffa51" priority="normal">
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C8bdc6a70-fb35-49fc-8113-0fb3aac3b041" priority="normal">
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C95a15bfe-e439-4f42-ac3f-eb3740da976a" priority="normal">
        <target>
            <property>
                <type name="RailwayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C05ddffbf-58b8-489b-b53b-44086656f42f" priority="normal">
        <source>
            <class>
                <type name="ax_bahnverkehrsanlage" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Objekte mit flächenartigen Geometrien behandeln
def areaGeometries = _.geom.findPolygons(_source.p.wkb_geometry.value()) ?: []

// Objekte mit punkartigen Geometrien behandeln
// Um Probleme mit der Validierung zu verhindern (Knoten werden am Ende von Kanten erwartet),
// werden in diesem Fall in Absprache mit der AdV aus den Punktgeometrien Pseudokreisflächen
// mit einem Flächeninhalt von &gt;=0,5 ha erzeugt.
def pointGeometries = _.geom.findPoints(_source.p.wkb_geometry.value()) ?: []
pointGeometries.each { geo -&gt;
	// Radius von 40.1 m führt zu gefordertem Flächeninhalt von &gt;=0,5 ha. Der sich mathematisch ergebende Radius
	// von ~39.9 m reicht aufgrund geometrischer Ungenauigkeiten nicht aus.
	areaGeometries &lt;&lt; _.geom.buffer(geometry: geo, distance: 40.1)
}

// Ziel unterstützt keine MultiSurfaces
def surfaces = _.geom.splitMulti(areaGeometries)

// Builder konfigurieren
// Zuweisung der Geometrie auf Ebene von geometry zulassen
_b.strictValueFlags = false

// Identifier des Quell-Objekts
def sourceId = _source.p.gml_id.value()

// bestimme ConditionOfFacility
def conditionOfFacility = 'functional'
switch (_source.p.zustand.value() as String) {
case '2100': // Außer Betrieb, stillgelegt, verlassen
	conditionOfFacility = 'disused'
	break
case '4000': // Im Bau
	conditionOfFacility = 'underConstruction'
	break
}

/*
 * Sammeln von Informationen bzgl. hatDirektUnten für VerticalPosition
 */
def untenRefs = _source.p.hatdirektunten.values()
def verticalPositions = untenRefs.findResults { identifier -&gt;
	def bwf = collect.bauwerksfunktion[identifier].value() as String
	if (bwf) {
		switch (bwf) {
		// AX_BauwerkImVerkehrsbereich
		case '1800': // Brücke
		case '1801': // Mehrstöckige Brücke
		case '1802': // Bogenbrücke
		case '1803': // Fachwerkbrücke
		case '1804': // Hängebrücke
		case '1805': // Pontonbrücke
		case '1806': // Drehbrücke
		case '1807': // Hebebrücke
		case '1808': // Zugbrücke
		case '1820': // Steg
		case '1830': // Hochbahn, Hochstraße
		case '1890': // Schleusenkammer
		// AX_BauwerkImGewaesserbereich
		case '2030': // Staumauer
		case '2040': // Staudamm
		case '2050': // Wehr
		case '2060': // Sicherheitstor
		case '2080': // Sperrwerk
			return 'suspendedOrElevated'
		// AX_BauwerkImVerkehrsbereich
		case '1870': // Tunnel, Unterführung
		// AX_BauwerkImGewaesserbereich
		case '2010': // Durchlass
		case '2011': // Rohrdurchlass
		case '2012': // Düker
		case '2070': // Siel
		case '2090': // Schöpfwerk
			return 'underground'
		}
	}
	else {
		null
	}
} as Set
def verticalPosition
if (!verticalPositions) {
	verticalPosition = 'onGroundSurface'
}
else {
	verticalPosition = verticalPositions.iterator().next()
	if (verticalPositions.size() &gt; 1) {
		_log.error('Multiple different values for vertical position of an object: ' + verticalPositions)
	}
}

// Ziel-Objekt für jede Fläche erstellen
int num = 1
surfaces.each { surface -&gt;
	// ID bestimmen
	def _id = "RailwayStationArea_${sourceId}_${num}"
	def _ns = _project.vars.INSPIRE_NAMESPACE

	// Ziel-Objekt erstellen (IDs und Geometrie)
	_target {
		id( _id )
		inspireId {
			Identifier {
				localId( _id )
				namespace( _ns )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		geometry(surface)
	}
	
	// Sammle ID für Netzwerk
	collect.network &lt;&lt; _id
	// Sammle ID für RailwayStationCode
	if (_source.p.bezeichnung.value()) {
		collect.railwayStationCode[_source.p.bezeichnung.value()] &lt;&lt; _id
	}
	// Sammle ID für ConditionOfFacility
	collect.conditionOfFacility[conditionOfFacility] &lt;&lt; _id
	// Sammle ID für VerticalPosition
	collect.verticalPosition[verticalPosition] &lt;&lt; _id

	num++
}
</core:text>
        </complexParameter>
        <documentation>Erstellt `RailwayStationAreas`s aus `AX_Bahnverkehrsanlage`.

Die Geometrie des Quell-Objekts wird untersucht. Nur flächenartige Geometrien verwendet. Je Fläche wird eine `RailwayStationArea` erzeugt.

Die lokale ID wird aus dem Namen der Ziel-Objektart, der AAA-ObjektID des Quell-Objekts und einer aufsteigenden Nummer der Fläche (1., 2., etc. Fläche der Geometrie) gebildet.

Die erstellte `RailwayStationArea` wird dem Index von Netzwerk-Elementen hinzugefügt.

Falls die `AX_Bahnverkehrsanlage` über eine `bezeichnung` verfügt, wird dem Index für `RailwayStationCode`s die `RailwayStationArea` ebenfalls hinzugefügt.

Zusätzlich werden folgende Informationen in den entsprechenden Indizes abgelegt:

**ConditionOfFacility**

Die *conditionOfFacility* wird wie folgt aus dem Attribut `zustand` ermittelt:

zustand | conditionOfFacility
- | -
`2100` *(Außer Betrieb, stillgelegt, verlassen)* | `disused`
`4000` *(Im Bau)* | `underConstruction`

In allen anderen Fällen wird *conditionOfFacility* als `functional` angenommen.

**VerticalPosition**

Die *verticalPosition* wird über das Attribut `hatDirektUnten` ermittelt.
Referenzen auf `AX_BauwerkImVerkehrsbereich` und `AX_BauwerkImGewaesserbereich` werden über einen Index nachgeschlagen um die entsprechende `bauwerksfunktion` zu erhalten.
Aus der `bauwerksfunktion` wird der Wert wie folgt ermittelt:

bauwerksfunktion | verticalPosition
- | -
`1800` *(Brücke)* | `suspendedOrElevated`
`1801` *(Mehrstöckige Brücke)* | `suspendedOrElevated`
`1802` *(Bogenbrücke)* | `suspendedOrElevated`
`1803` *(Fachwerkbrücke)* | `suspendedOrElevated`
`1804` *(Hängebrücke)* | `suspendedOrElevated`
`1805` *(Pontonbrücke)* | `suspendedOrElevated`
`1806` *(Drehbrücke)* | `suspendedOrElevated`
`1807` *(Hebebrücke)* | `suspendedOrElevated`
`1808` *(Zugbrücke)* | `suspendedOrElevated`
`1820` *(Steg)* | `suspendedOrElevated`
`1830` *(Hochbahn, Hochstraße)* | `suspendedOrElevated`
`1890` *(Schleusenkammer)* | `suspendedOrElevated`
`2030` *(Staumauer)* | `suspendedOrElevated`
`2040` *(Staudamm)* | `suspendedOrElevated`
`2050` *(Wehr)* | `suspendedOrElevated`
`2060` *(Sicherheitstor)* | `suspendedOrElevated`
`2080` *(Sperrwerk)* | `suspendedOrElevated`
`1870` *(Tunnel, Unterführung)* | `underground`
`2010` *(Durchlass)* | `underground`
`2011` *(Rohrdurchlass)* | `underground`
`2012` *(Düker)* | `underground`
`2070` *(Siel)* | `underground`
`2090` *(Schöpfwerk)* | `underground`

Für alle anderen `bauwerksfunktion`en, Referenzen auf andere Objekte oder auch bei Nicht-Vorhandensein von Referenzen wird der Wert `onGroundSurface` angenommen. Bei mehreren verschiedenen Referenzen haben `suspendedOrElevated` und `underground` Vorrang vor `onGroundSurface`.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C48d3be90-5843-4323-bd79-ba1928b2429e_C05ddffbf-58b8-489b-b53b-44086656f42f" priority="normal">
        <source>
            <property>
                <type name="ax_bahnverkehrsanlage" ns="jdbc:postgresql:testbed:public"/>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C92d71e60-b3b7-4864-a6a2-fc6d46d9ac4c_C05ddffbf-58b8-489b-b53b-44086656f42f" priority="normal">
        <source>
            <property>
                <type name="ax_bahnverkehrsanlage" ns="jdbc:postgresql:testbed:public"/>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="Ccf4d6e03-e860-410d-a4dc-2a47bc1b747a" priority="normal">
        <source name="spelling">
            <property>
                <type name="ax_bahnverkehrsanlage" ns="jdbc:postgresql:testbed:public"/>
                <child name="name"/>
            </property>
        </source>
        <target>
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C2fd3d7ec-9da9-47f0-af0d-8502ced21036" priority="normal">
        <target>
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unknown" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C03716a0b-a2f7-4f4b-8d93-13d186c7af73_C05ddffbf-58b8-489b-b53b-44086656f42f" priority="normal">
        <target name="result">
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="inNetwork" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">'#' + _project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Verknüpft das Netzwerk-Element mit dem entsprechenden *TransportNetwork*.
Dazu wird die vorgegebene ID für das Netzwerk verwendet (Projekt-Variable).</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cad0cc7de-46e9-4eca-9c22-a50a195d20df" priority="normal">
        <target>
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cfe820c80-b3ae-4187-9e5d-3ebf7baccc3f" priority="normal">
        <target>
            <property>
                <type name="RailwayStationAreaType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C1f082d85-af49-4d27-bb48-4861e974d752" priority="low">
        <target>
            <class>
                <type name="RailwayStationCodeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein RailwayStationCode-Objekt für jeden vorkommenden Wert
collect.railwayStationCode.consume { key, values -&gt;
	def _id = 'RailwayStationCode_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		stationCode( key )
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Objekten mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `RailwayStationCode`-Objekt für jeden in den Daten vorkommenden Wert für `stationCode`.

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Wert gebildet. **Es ist zu prüfen ob das so immer zu gültigen GML IDs führt.**

Es werden Referenzen (NetworkReference) zu allen Netzwerk-Elementen (z.B. `RailwayStationArea` und `RailwayStationNode`) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C1f082d85-af49-4d27-bb48-4861e974d752" priority="normal">
        <target>
            <property>
                <type name="RailwayStationCodeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C1f082d85-af49-4d27-bb48-4861e974d752" priority="normal">
        <target>
            <property>
                <type name="RailwayStationCodeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C2a6fa58e-9358-425c-aec0-cbb52951e52a" priority="low">
        <target>
            <class>
                <type name="RailwayTypeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Die Code-Liste für RailwayType
def codeList = 'http://inspire.ec.europa.eu/codelist/RailwayTypeValue'

def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein RailwayType-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.railwayType.consume { key, values -&gt;
	def _id = 'RailwayType_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		type {
			href( "$codeList/$key" )
		}
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `RailwayType`-Objekt für jeden in den Daten vorkommenden Wert der [Railway Type Code-Liste](http://inspire.ec.europa.eu/codelist/RailwayTypeValue).

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Wert gebildet.

Es werden Referenzen (NetworkReference) zu allen Netzwerk-Elementen (z.B. `RailwayArea` und `RailwayLink`) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C2a6fa58e-9358-425c-aec0-cbb52951e52a" priority="normal">
        <target>
            <property>
                <type name="RailwayTypeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C2a6fa58e-9358-425c-aec0-cbb52951e52a" priority="normal">
        <target>
            <property>
                <type name="RailwayTypeType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="Ca65a86a4-b0ae-482f-bb27-b8e9c5b51713" priority="low">
        <target>
            <class>
                <type name="RailwayUseType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Die Code-Liste für RailwayUse
def codeList = 'http://inspire.ec.europa.eu/codelist/RailwayUseValue'

def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein RailwayUse-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.railwayUse.consume { key, values -&gt;
	def _id = 'RailwayUse_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		_b.createProperty('use') {
			href( "$codeList/$key" )
		}
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `RailwayUse`-Objekt für jeden in den Daten vorkommenden Wert der [Railway Use Code-Liste](http://inspire.ec.europa.eu/codelist/RailwayUseValue).

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Wert gebildet.

Es werden Referenzen (NetworkReference) zu allen Netzwerk-Elementen (z.B.  `RailwayLink`) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_Ca65a86a4-b0ae-482f-bb27-b8e9c5b51713" priority="normal">
        <target>
            <property>
                <type name="RailwayUseType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_Ca65a86a4-b0ae-482f-bb27-b8e9c5b51713" priority="normal">
        <target>
            <property>
                <type name="RailwayUseType" ns="http://inspire.ec.europa.eu/schemas/tn-ra/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C376c9fef-ac45-4e2c-9941-651740ba7400" priority="lowest">
        <target>
            <class>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collector

withTransformationContext {
	collector = _.context.collector(it)
}

_target {
	// Verknüpfung zu gesammelten Netzwerk-Elementen
	collector.network.each { id -&gt;
		elements {
			href( "#$id" )
		}
	}
}

</core:text>
        </complexParameter>
        <documentation>Erstellt das *TransportNetwork* für diese Netzwerk.

Zuvor wurde beim Erstellen jedes Netzwerk-Elements dessen GML id in einem Index abgelegt. Diese Information wird hier nun genutzt um auf alle Elemente des Netzwerks zu verweisen.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C60a849e5-b891-4866-8022-0cd07e0f01f4" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="language" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="deu" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C8bd6e468-105d-4337-a3e7-f7355ed60664" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="nameStatus" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/NameStatusValue/official" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C56e9b1b9-1ade-49d5-9f53-37423fe9d061" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="nativeness" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/NativenessValue/endonym" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cf2ce1338-3fce-4a09-807d-09c3e76262d0" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="pronunciation" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="Cd1613f96-fd11-4e0b-b093-d38ce17cb580" priority="normal">
        <target name="result">
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="sourceOfName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def modellArt = _project.vars.ADV_MODELLART
if (modellArt) {
	_target(modellArt)
}
else {
	_target {
		nilReason( 'unknown' )
	}
}
</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Bestimmung aus Projekt-Variable (`ADV_MODELLART`) falls vorhanden, andernfalls wird *nilReason* auf `unknown` gesetzt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cd4048617-c86f-4863-99b5-3e9f0635a8f5" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="spelling" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="SpellingOfName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="script" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="Latn" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C76fb8de5-dd5d-47c3-824e-3c37906a2c89" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="spelling" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="SpellingOfName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="text" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="{{project:NETWORK_NAME}}" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C79bec27b-cdca-459d-9ecc-540aeca29d4b" priority="normal">
        <target name="result">
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">_project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Weist die vorgegebene lokale ID für das Netzwerk zu.

Die Vorgabe kann über eine Projekt-Variable überschrieben werden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="Cad28e1b9-331b-4b75-838f-94b202fdba1f" priority="normal">
        <target name="result">
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Zusammenfügen von INSPIRE namespace und localId

// namespace
def namespace = _project.vars.INSPIRE_NAMESPACE
// localId (vorgegebene localId für das Netzwerk)
def id = _project.vars.NETWORK_ID

if (namespace) {
  if (!namespace.endsWith('/')) {
    namespace = namespace + '/'
  }
  
  // namespace und id als Ergebnis
  namespace + id
}
else {
  // nur id als Ergebnis
  id
}
</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Erzeugt einen GML identifier basierend auf der INSPIRE ID. Dazu wird der vorgegebene INSPIRE Namespace und die vorgegebene lokale ID für das Netzwerk hinzugezogen.

Beide Vorgaben können über eine Projekt-Variable überschrieben werden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cc9255943-592d-4e33-b874-03846d8c9a3c" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
                <child name="codeSpace"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/ids" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Caddb8db5-f486-4664-a6b8-edd9eb936efe" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
        <parameter value="{{project:NETWORK_ID}}" name="value"/>
        <documentation>Weist die vorgegebene lokale ID für das Netzwerk zu.

Die Vorgabe kann über eine Projekt-Variable überschrieben werden.</documentation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C935f563e-2939-4fcc-aecc-8029498b746b" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/4.0"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C13ad15bd-b849-403e-bcf4-ec122b3998bd" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="typeOfTransport" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/TransportTypeValue/rail" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C00cccf8c-b815-4fa9-b89c-6f37d12ae435" priority="lowest">
        <target>
            <class>
                <type name="VerticalPositionType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein VerticalPosition-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.verticalPosition.consume { key, values -&gt;
	def _id = 'VerticalPosition_' + _project.vars.THEME_DISTINGUISHER + '_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		verticalPosition {
			href( 'http://inspire.ec.europa.eu/codelist/VerticalPositionValue/' + key )
		}
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C00cccf8c-b815-4fa9-b89c-6f37d12ae435" priority="normal">
        <target>
            <property>
                <type name="VerticalPositionType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C00cccf8c-b815-4fa9-b89c-6f37d12ae435" priority="normal">
        <target>
            <property>
                <type name="VerticalPositionType" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/5.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <modifier cell="C48d3be90-5843-4323-bd79-ba1928b2429e_Ca500e629-76b0-4cda-b53f-c9db0c272403">
        <disable-for parent="Ca500e629-76b0-4cda-b53f-c9db0c272403"/>
    </modifier>
    <modifier cell="C4bcaaeda-f8c5-41c5-8efa-bc3a2eaffa51">
        <disable-for parent="C433d8afa-844b-4e56-b6c8-82e369fd15ea"/>
    </modifier>
    <modifier cell="C92d71e60-b3b7-4864-a6a2-fc6d46d9ac4c_Ca500e629-76b0-4cda-b53f-c9db0c272403">
        <disable-for parent="Ca500e629-76b0-4cda-b53f-c9db0c272403"/>
    </modifier>
</alignment>
