<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<alignment xmlns="http://www.esdi-humboldt.eu/hale/alignment">
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.geometry.simplefeature" name="Simple Feature Geometrie" type="groovy">
            <cf:input eager="true" maxOccurs="1" minOccurs="1" name="geometrie"/>
            <cf:output eager="false" maxOccurs="1" minOccurs="1"/>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def geoms = _.geom.toSimpleGeometries(geometries: _.geom.aggregate(geometrie), collections: false)
if (geoms) {
	if (geoms.size() &gt; 1) {
		_log.error("Mehrere Geometrien gefunden - Aufteilung nötig")
	}
	_target(geoms[0])
}
else {
	_log.error("Keine Geometrie gefunden")
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Überführt die Quell-Geometrien als eine zusammengefasste Simple Feature Geometrie (ohne Multi-Geometrien).

Nur erfolgreich falls genau eine Simple Feature Geometrie gebildet werden kann. Andernfalls wird ein entsprechender Fehler in die Transformations-Logs eingetragen.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.geometry.simplefeature.multi" name="Simple Feature Geometrie (Multi)" type="groovy">
            <cf:input eager="true" maxOccurs="1" minOccurs="1" name="geometrie"/>
            <cf:output eager="false" maxOccurs="1" minOccurs="1"/>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def geoms = _.geom.toSimpleGeometries(geometries: _.geom.aggregate(geometrie), collections: true)
if (geoms) {
	if (geoms.size() &gt; 1) {
		_log.error("Mehrere Geometrien gefunden - Aufteilung nötig")
	}
	_target(geoms[0])
}
else {
	_log.error("Keine Geometrie gefunden")
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Überführt die Quell-Geometrien als eine zusammengefasste Simple Feature Geometrie (ggf. als Multi-Geometrie).

Nur erfolgreich falls genau eine Simple Feature Geometrie gebildet werden kann. Andernfalls wird ein entsprechender Fehler in die Transformations-Logs eingetragen.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.AX_Lagebezeichnung.GeographicalName" name="AX_Lagebezeichnung zu GeographicalName" type="groovy">
            <cf:input eager="false" maxOccurs="1" minOccurs="1" name="lagebezeichnung">
                <cf:binding>java.lang.String</cf:binding>
                <cf:type name="AX_LagebezeichnungType" ns="http://www.adv-online.de/namespaces/adv/gid/7.1"/>
            </cf:input>
            <cf:input eager="false" maxOccurs="1" minOccurs="0" name="source">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:type name="GeographicalNameType" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </cf:output>
            <cf:param maxOccurs="1" minOccurs="0" name="source">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Quelle des Namens. Falls nicht angegeben wird sie aus einer Projekt-Variable bestimmt.</core:text>
                </cf:description>
                <cf:display value="Source of name"/>
                <cf:binding>java.lang.String</cf:binding>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nameStatus">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Status des Namens. Falls nicht angegeben wird als Standardwert official angenommen.</core:text>
                </cf:description>
                <cf:display value="nameStatus"/>
                <cf:value>standardised</cf:value>
                <cf:value>other</cf:value>
                <cf:value>official</cf:value>
                <cf:value>historical</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nativeness">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Ortsüblichkeit des Namens. Falls nicht angegeben wird als Standardwert endonym angenommen.</core:text>
                </cf:description>
                <cf:display value="nativeness"/>
                <cf:value>endonym</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>exonym</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def name = lagebezeichnung.p.unverschluesselt.value()

if (!name) {
	// Namen auch aus verschlüsselter Lagebezeichnung ableiten
	
	def gemeinde = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.gemeinde.value()
	def kreis = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.kreis.value()
	def lage = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.lage.value()
	def land = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.land.value()
	def reg = lagebezeichnung.p.verschluesselt.AX_VerschluesselteLagebezeichnung.regierungsbezirk.value()

	if (land &amp;&amp; gemeinde &amp;&amp; kreis &amp;&amp; lage) {
		if (!reg) reg = '0'
		def schluesselGesamt = "$land$reg$kreis$gemeinde$lage"
		
		withTransformationContext {
			def collect = _.context.collector(it)
	  
			// Name zu Schlüssel der Lagebezeichnung aus Index holen
			if (collect.lagebezeichnung[schluesselGesamt].value()){
				name = collect.lagebezeichnung[schluesselGesamt].value()
			}
			else _log.error("Für einen Namen aus einer verschlüsselten Lagebezeichnung mit Schlüssel ${schluesselGesamt} liegt kein Katalogeintrag vor.")
		}
	}
}

if (name) {
	def sourceName_var = _project.vars.get('ADV_MODELLART', null)

	_target {
		// source

		// Priorität 1 - feste Quelle
		if (_params.source) {
			sourceOfName( _params.source )
		}
		// Priorität 2 - aus Projektvariable
		else if (sourceName_var) {
			sourceOfName( sourceName_var )
		}
		else {
			sourceOfName {
				nilReason( 'unknown' )
			}
		}

		// nativeness
		def nn = _params.nativeness
		if (nn) {
			if (nn == 'unpopulated') {
				nativeness {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (nn == 'unknown') {
				nativeness {
					nilReason( 'unknown' )
				}
			}
			else {
				nativeness {
					href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/' + nn )
				}
			}
		}
		else {
			// default for nativeness if not specified is endonym
			nativeness {
				href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/endonym' )
			}
		}

		// nameStatus
		def ns = _params.nameStatus
		if (ns) {
			if (ns == 'unpopulated') {
				nameStatus {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (ns == 'unknown') {
				nameStatus {
					nilReason( 'unknown' )
				}
			}
			else {
				nameStatus {
					href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/' + ns )
				}
			}
		}
		else {
			// default for nameStatus if not specified is official
			nameStatus {
				href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/official' )
			}
		}

		// spelling
		spelling {
			SpellingOfName {
				text( name )
				script( 'Latn' )
			}
		}
		// language
		language( 'deu' )
	}
}
else {
	throw new NoResultException()
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Erstellt ein GeographicalName-Objekt aus einer Lagebezeichnung.&#13;
Eine unverschlüsselte Lagebezeichnung wird direkt als Name übernommen.&#13;
Falls stattdessen eine verschlüsselte Lagebezeichnung vorliegt (nur in ALKIS/DLKM möglich), wird versucht den Namen über den Schlüssel in einem Index nachzuschlagen.&#13;
Trifft keiner der beiden Fälle zu, oder kann der Name nicht nachgeschlagen werden, wird kein GeographicalName erzeugt.&#13;
&#13;
Die Sprache des Namens wird als Deutsch angenommen.&#13;
&#13;
&lt;% if (_params.nameStatus) {&#13;
  if (_params.nameStatus == 'unpopulated') {&#13;
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."&#13;
  }&#13;
  else if (_params.nameStatus == 'unknown') {&#13;
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."&#13;
  }&#13;
  else {&#13;
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als ${_params.nameStatus} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."&#13;
  }&#13;
}&#13;
else {&#13;
  out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als *official* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."&#13;
}&#13;
out &lt;&lt; "\n\n"&#13;
if (_params.nativeness) {&#13;
  if (_params.nativeness == 'unpopulated') {&#13;
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."&#13;
  }&#13;
  else if (_params.nativeness == 'unknown') {&#13;
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."&#13;
  }&#13;
  else {&#13;
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als ${_params.nativeness} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."&#13;
  }&#13;
}&#13;
else {&#13;
  out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als *endonym* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."&#13;
}&#13;
out &lt;&lt; "\n\n"&#13;
if (_params.source) {&#13;&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird als ${_params.source} angegeben."&#13;&#13;
} else {&#13;&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird aus einer Projekt-Variable (`ADV_MODELLART`) bestimmt, falls vorhanden."&#13;&#13;
} %&gt;
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.GeographicalName.simple" name="Einfacher GeographicalName (Deutsch)" type="groovy">
            <cf:input eager="false" maxOccurs="1" minOccurs="1" name="spelling">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:input eager="true" maxOccurs="1" minOccurs="0" name="source">
                <cf:binding>java.lang.String</cf:binding>
                <cf:type name="AA_ModellartPropertyType" ns="http://www.adv-online.de/namespaces/adv/gid/7.1"/>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:type name="GeographicalNameType" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </cf:output>
            <cf:param maxOccurs="1" minOccurs="0" name="source">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Quelle des Namens. Falls nicht angegeben wird sie aus einer Projekt-Variable oder, falls konfiguriert, aus dem Quell-Objekt bestimmt.</core:text>
                </cf:description>
                <cf:display value="Source of name"/>
                <cf:binding>java.lang.String</cf:binding>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nameStatus">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Status des Namens. Falls nicht angegeben wird als Standardwert official angenommen.</core:text>
                </cf:description>
                <cf:display value="nameStatus"/>
                <cf:value>standardised</cf:value>
                <cf:value>other</cf:value>
                <cf:value>official</cf:value>
                <cf:value>historical</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:param maxOccurs="1" minOccurs="0" name="nativeness">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Ortsüblichkeit des Namens. Falls nicht angegeben wird als Standardwert endonym angenommen.</core:text>
                </cf:description>
                <cf:display value="nativeness"/>
                <cf:value>endonym</cf:value>
                <cf:value>unpopulated</cf:value>
                <cf:value>exonym</cf:value>
                <cf:value>unknown</cf:value>
            </cf:param>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def sourceNameFromModellart() {
	if (source) {
		def modelle = source.p.AA_Modellart.advStandardModell.values()
		if (modelle) {
			//TODO Logik um korrektes anzugebendes Modell zu bestimmen?
			//XXX Vorerst wird erstes Modell zurückgegeben
			return modelle[0]
		}
	}
	
	null
}

def sourceName_input = sourceNameFromModellart()
def sourceName_var = _project.vars.get('ADV_MODELLART', null)

if (spelling) {
	_target {
		
		// Priorität 1 - feste Quelle
		if (_params.source) {
			sourceOfName( _params.source )
		}
		// Priorität 2 - aus Projektvariable
		else if (sourceName_var) {
			sourceOfName( sourceName_var )
		}
		// Priorität 3 - aus Quell-Objekt
		else if (sourceName_input) {
			sourceOfName( sourceName_input )
		}
		else {
			sourceOfName {
				nilReason( 'unknown' )
			}
		}
		pronunciation {
			nilReason( 'other:unpopulated' )
		}
		// nameStatus
		def ns = _params.nameStatus
		if (ns) {
			if (ns == 'unpopulated') {
				nameStatus {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (ns == 'unknown') {
				nameStatus {
					nilReason( 'unknown' )
				}
			}
			else {
				nameStatus {
					href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/' + ns )
				}
			}
		}
		else {
			// default for nameStatus if not specified is official
			nameStatus {
				href( 'http://inspire.ec.europa.eu/codelist/NameStatusValue/official' )
			}
		}
		// nativeness
		def nn = _params.nativeness
		if (nn) {
			if (nn == 'unpopulated') {
				nativeness {
					nilReason( 'other:unpopulated' )
				}
			}
			else if (nn == 'unknown') {
				nativeness {
					nilReason( 'unknown' )
				}
			}
			else {
				nativeness {
					href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/' + nn )
				}
			}
		}
		else {
			// default for nativeness if not specified is endonym
			nativeness {
				href( 'http://inspire.ec.europa.eu/codelist/NativenessValue/endonym' )
			}
		}
		spelling {
			SpellingOfName {
				text( spelling )
				script ( 'Latn' )
			}
		}
		language( 'deu' )
	}
}
else {
	throw new NoResultException()
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Bildet ein GeographicalName-Objekt zu einem einfachen Namen. Der Wert des Quell-Attributs $spelling wird als Schreibweise des Namens übernommen (`SpellingOfName`).&#13;
&#13;
Die Sprache wird als Deutsch angenommen.&#13;

&lt;% if (_params.nameStatus) {
  if (_params.nameStatus == 'unpopulated') {
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."
  }
  else if (_params.nameStatus == 'unknown') {
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."
  }
  else {
    out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als ${_params.nameStatus} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."
  }
}
else {
  out &lt;&lt; "Der Status des Namens (`nameStatus`) wird als *official* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NameStatusValue&gt;)."
}
out &lt;&lt; "\n\n"
if (_params.nativeness) {
  if (_params.nativeness == 'unpopulated') {
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `other:unpopulated` angegeben."
  }
  else if (_params.nativeness == 'unknown') {
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird nicht angegeben, als *nilReason* wird `unknown` angegeben."
  }
  else {
    out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als ${_params.nativeness} angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."
  }
}
else {
  out &lt;&lt; "Die Ortsüblichkeit (`nativeness`) wird als *endonym* angegeben (siehe &lt;http://inspire.ec.europa.eu/codelist/NativenessValue&gt;)."
}
out &lt;&lt; "\n\n"
if (_params.source) {&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird als ${_params.source} angegeben."&#13;
} else if (source) {&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird aus einer Projekt-Variable (`ADV_MODELLART`) bestimmt, falls vorhanden, andernfalls wird das Quell-Attribut $source dafür herangezogen. "&#13;
  out &lt;&lt; "In letzterem Fall kann nur eine von potentiell mehreren im Quellobjekt angegebenen Modellarten übernommen werden."&#13;
} else {&#13;
  out &lt;&lt; "Die Quelle des Namens (`sourceOfName`) wird aus einer Projekt-Variable (`ADV_MODELLART`) bestimmt, falls vorhanden."&#13;
} %&gt;
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.date.earliest" name="Jüngstes Datum" type="groovy">
            <cf:input eager="true" maxOccurs="-1" minOccurs="1" name="dates">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
//import java.text.SimpleDateFormat
//def formatter = new SimpleDateFormat('yyyy-MM-dd')

// all source dates as list
def values = dates.p.values()

if (!values) {
	// no result
	return null
}

// try to convert to date
values = values.collect { value -&gt;
	def result
	//XXX skip instanceof check - instanceof is not supported by Groovy Sandbox
	// and Class.isInstance requires the Groovy restriction to be lifted
	//if (Date.isInstance(value)) {
	//	result = value
	//}
	//TODO also support parsing based on provided pattern?
	if (result == null) {
		// try hale conversion
		result = _.convert(value: value, to: Date)
	}
	if (result == null) {
		result = value as Date
	}
	result
}

// sort dates
values.sort()

// yield last date
values[-1]
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Liefert das jüngste Datum/Zeit aller Eingabedaten.</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.id.default" name="AdV INSPIRE localId" type="groovy">
            <cf:input eager="true" maxOccurs="-1" minOccurs="1" name="id">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:param maxOccurs="1" minOccurs="0" name="collectorName">
                <cf:description>
                    <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">Name eines Kollektors, der verwendet werden soll, um die erzeugten IDs zu sammeln.</core:text>
                </cf:description>
                <cf:display value="Collector name"/>
                <cf:binding>java.lang.String</cf:binding>
            </cf:param>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// alle Quell-IDs als Liste
def identifiers = id.p.values()

def id

if (identifiers.size() == 1) {
  // verwende Original-ID falls nur eine Quelle
  id = identifiers[0]
}
else {
  // sortieren (TODO spezielle Ordnung benötigt?)
  identifiers = identifiers.sort()

  def identString = identifiers.join()

  id = '_' + _.crypto.sha256(identString)
}

// Ziel-Typ als Präfix
if (true /*_params.useTargetTypePrefix*/) {
  def targetType = _targetType.definition.name.localPart
  if (targetType) {
    if (targetType.endsWith('Type')) {
      targetType = targetType[0..-5]
    }
  
    if (!id.startsWith('_')) {
      id = '_' + id
    }
    id = targetType + id
  }
}

// Falls ein Collector-Name angegeben wurde, IDs in diesem einspeisen

if (_params.collectorName) {
  withTransformationContext {
    def c = _.context.collector(it)
    c[_params.collectorName] &lt;&lt; id
  }
}

id
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Bestimmung einer INSPIRE localId oder GML id aus Fachkennzeichen oder AAA-ObjektIDs.

Für eine einzige Quell-ID wird diese direkt herangezogen.

Andernfalls wird unter Verwendung des SHA256-Algorithmus ein Hash-Wert aus den sortierten und dann konkatenierten Quell-IDs gebildet und hexadezimal kodiert.

Außerdem wird der Name des Feature-Typs des Ziel-Modells als Präfix vorangestellt. Dabei wird sichergestellt dass der Typ-Name von den weiteren Teilen der ID durch einen Unterstrich getrennt ist.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.identifier" name="AdV INSPIRE identifier (URI)" type="groovy">
            <cf:input eager="true" maxOccurs="-1" minOccurs="1" name="id">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:type name="CodeWithAuthorityType" ns="http://www.opengis.net/gml/3.2"/>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// alle Quell-IDs als Liste
def identifiers = id.p.values()

def id

if (identifiers.size() == 1) {
  // verwende Original-ID falls nur eine Quelle
  id = identifiers[0]
}
else {
  // sortieren (TODO spezielle Ordnung benötigt?)
  identifiers = identifiers.sort()

  def identString = identifiers.join()

  id = '_' + _.crypto.sha256(identString)
}

// Ziel-Typ als Präfix
if (true /*_params.useTargetTypePrefix*/) {
  def targetType = _targetType.definition.name.localPart
  if (targetType) {
    if (targetType.endsWith('Type')) {
      targetType = targetType[0..-5]
    }
  
    if (!id.startsWith('_')) {
      id = '_' + id
    }
    id = targetType + id
  }
}

// Verknüpfung mit namespace
def namespace = _project.vars.INSPIRE_NAMESPACE
if (namespace) {
  if (!namespace.endsWith('/')) {
    namespace = namespace + '/'
  }
  
  // namespace und id als Ergebnis
  _target(namespace + id) {
	codeSpace( 'http://inspire.ec.europa.eu/ids' )
  }
}
else {
  // nur id als Ergebnis
  _target(id) {
	codeSpace( 'http://inspire.ec.europa.eu/ids' )
  }
}
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Bestimmung eines GML identifiers URI bestehend INSPIRE namespace und localId aus Fachkennzeichen oder AAA-ObjektIDs.

Für eine einzige Quell-ID wird diese direkt für die localId herangezogen. Andernfalls wird unter Verwendung des SHA256-Algorithmus ein Hash-Wert aus den sortierten und dann konkatenierten Quell-IDs gebildet und hexadezimal kodiert.
Als Präfix wird der localId der Name des Feature-Typs des Ziel-Modells vorangestellt. Dabei wird sichergestellt dass der Typ-Name von den weiteren Teilen der ID durch einen Unterstrich getrennt ist.

Der für Datenanbieter und Datensatz spezifische Namespace muss als Vorgabe (Projekt-Variable) konfiguriert werden.

Der `codeSpace` für den GML identifier wird als `http://inspire.ec.europa.eu/ids` gesetzt.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.inspire.namespace" name="AdV INSPIRE ID namespace" type="groovy">
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// verwende Wert aus Projekt-Variable "INSPIRE_NAMESPACE"
_project.vars.INSPIRE_NAMESPACE
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Setzt $_target auf den für den Datensatz vorgegebenen festen INSPIRE Namespace.

Der für Datenanbieter und Datensatz spezifische Namespace muss dafür als Vorgabe (Projekt-Variable) konfiguriert werden.
</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <customFunction>
        <cf:custom-property-function xmlns:cf="http://www.esdi-humboldt.eu/hale/custom-function" identifier="adv.uom.toucum" name="AdV Maßeinheit zu UCUM" type="groovy">
            <cf:input eager="false" maxOccurs="1" minOccurs="1" name="uom">
                <cf:binding>java.lang.String</cf:binding>
            </cf:input>
            <cf:output eager="false" maxOccurs="1" minOccurs="1">
                <cf:binding>java.lang.String</cf:binding>
            </cf:output>
            <cf:definition>
                <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
if (!uom) {
	throw new NoResultException()
}

def result

// Mapping auf UCUM
switch(uom) {
case 'urn:adv:uom:m2':
	result = 'm2'
	break
case 'urn:adv:uom:m':
	result = 'm'
	break
case 'urn:adv:uom:km':
	result = 'km'
	break
}

if (!result) {
	// Transformations-Warnung falls kein Mapping auf UCUM vorhanden
	_log.warn("Unknown UCUM representation for unit of measurment $uom, using code as-is")
	result = uom
}

result
</core:text>
            </cf:definition>
            <cf:explanation>
                <cf:locale country="" language="" variant="">
                    <cf:template>
                        <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
Abbildung von Maßeinheiten aus AdV URNs nach UCUM

*Keine vollständige Abbildung, muss ggf. ergänzt werden.*

Aktuell ist folgende Abbildung umgesetzt:

- `urn:adv:uom:m2` zu `m2`
- `urn:adv:uom:m`zu `m`

</core:text>
                    </cf:template>
                </cf:locale>
            </cf:explanation>
        </cf:custom-property-function>
    </customFunction>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C33b5349d-fb85-4c7d-8519-ac27e4c49867" priority="highest">
        <source>
            <class>
                <type name="ax_bauwerkimgewaesserbereich" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="AbstractFeatureType" ns="http://www.opengis.net/gml/3.2"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def bwf = _source.p.bauwerksfunktion.value()
def identifier = _source.p.identifier.value()

withTransformationContext {
  def collect = _.context.collector(it)
  
  // Bauwerksfunktion zu Identifier des Objekts im Index ablegen
  collect.bauwerksfunktion[identifier] = bwf
}
</core:text>
        </complexParameter>
        <documentation>Dies ist eine Dummy-Transformationsdefinition die keine Objekte erzeugt sondern zum Aufbauen eines Index für die Bauwerksfunktion von `AX_BauwerkImGewaesserbereich` dient.
Diese Information wird herangezogen um entsprechend für REO-Objekte über die Beziehung `hatDirektUnten` den entsprechenden Wert für die *TransportProperty* `VerticalPosition` zu bestimmen.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C43232927-f863-47e3-b297-dd8902f4bbc7" priority="highest">
        <source>
            <class>
                <type name="ax_bauwerkimverkehrsbereich" ns="jdbc:postgresql:testbed:public"/>
            </class>
        </source>
        <target>
            <class>
                <type name="AbstractFeatureType" ns="http://www.opengis.net/gml/3.2"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def bwf = _source.p.bauwerksfunktion.value()
def identifier = _source.p.identifier.value()

withTransformationContext {
  def collect = _.context.collector(it)
  
  // Bauwerksfunktion zu Identifier des Objekts im Index ablegen
  collect.bauwerksfunktion[identifier] = bwf
}
</core:text>
        </complexParameter>
        <documentation>Dies ist eine Dummy-Transformationsdefinition die keine Objekte erzeugt sondern zum Aufbauen eines Index für die Bauwerksfunktion von `AX_BauwerkImVerkehrsbereich` dient.
Diese Information wird herangezogen um entsprechend für REO-Objekte über die Beziehung `hatDirektUnten` den entsprechenden Wert für die *TransportProperty* `VerticalPosition` zu bestimmen.</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.retype" id="C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <class>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (bahnkategorie = '2500')</condition>
                </type>
            </class>
        </source>
        <target>
            <class>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// nur Objekt mit linienartigen Geometrien behandeln
def geometries = _.geom.findLines(_source.p.position.first())

// Ziel unterstützt keine MultiLineStrings
def curves = _.geom.toSimpleGeometries(geometries: geometries, collections: false)

// Builder konfigurieren
// - Zuweisung der Geometrie auf Ebene von geometry zulassen
_b.strictValueFlags = false

def sourceId = _source.p.id.value()

// Ziel-Objekt für jede Linie erstellen
int num = 1
curves.each { curve -&gt;
	// ID bestimmen
	def _id = "CablewayLink_${sourceId}_${num}"
	def _ns = _project.vars.INSPIRE_NAMESPACE

	// Ziel-Objekt erstellen
	_target {
		id( _id )
		inspireId {
			Identifier {
				localId( _id )
				namespace( _ns )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		centrelineGeometry(curve)
	}
	
	withTransformationContext {
		def collect = _.context.collector(it)
		// Sammle ID für Netzwerk	
		collect.network &lt;&lt; _id
	}
	
	num++
}
</core:text>
        </complexParameter>
        <documentation>Erstellt `CablewayLink` aus einer `AX_SeilbahnSchwebebahn` (nicht `bahnkategorie` *Schwebebahn*).

Die Geometrie des Quell-Objekts wird untersucht. Nur linienartige Geometrien werden verwendet. Je individueller Geometrie wird ein `CablewayLink` erzeugt.

Die lokale ID wird aus dem Namen der Ziel-Objektart, der AAA-ObjektID des Quell-Objekts und einer aufsteigenden Nummer der individuellen Geometrien (1., 2., Geometrie) gebildet.

Die erstellten `CablewayLink`s werden dem Index von Netzwerk-Elementen hinzugefügt.
</documentation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">The cell's source entities have been replaced, the new entities may have a different structure and/or names and may require updating the Groovy script accordingly</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C51932291-90fa-45c4-9625-e372e60f65a2_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (bahnkategorie = '2500')</condition>
                </type>
                <child name="beginnt"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.classification" id="C5f8353d2-54ee-47d4-8abb-62c2c585ba41_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (bahnkategorie = '2500')</condition>
                </type>
                <child name="bahnkategorie"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="cablewayType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="lookupTable">
            <lookup-table xmlns:ns2="http://www.esdi-humboldt.eu/hale/alignment" xmlns="">
                <entry>
                    <key value="2100"/>
                    <value value="http://inspire.ec.europa.eu/codelist/CablewayTypeValue/cabinCableCar"/>
                </entry>
                <entry>
                    <key value="2200"/>
                    <value value="http://inspire.ec.europa.eu/codelist/CablewayTypeValue/cabinCableCar"/>
                </entry>
                <entry>
                    <key value="2300"/>
                    <value value="http://inspire.ec.europa.eu/codelist/CablewayTypeValue/chairLift"/>
                </entry>
                <entry>
                    <key value="2400"/>
                    <value value="http://inspire.ec.europa.eu/codelist/CablewayTypeValue/skiTow"/>
                </entry>
            </lookup-table>
        </complexParameter>
        <parameter value="null" name="notClassifiedAction"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C1107dba0-b8e6-4f84-95b6-36c2015934be" priority="normal">
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="cablewayType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="unknown" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.rename" id="C81ac1a4a-1acc-42f8-b12b-4758e5ce12b7_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source>
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (bahnkategorie = '2500')</condition>
                </type>
                <child name="endet"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="endLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="ignoreNamespaces"/>
        <parameter value="false" name="structuralRename"/>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cdebc2019-9966-4798-ba79-2c5a23c84db1" priority="normal">
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="fictitious" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
            </property>
        </target>
        <parameter value="false" name="value"/>
    </cell>
    <cell relation="custom:alignment:adv.inspire.GeographicalName.simple" id="C5ee0f9dd-3579-4712-a379-af803911bc0e_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <source name="spelling">
            <property>
                <type name="ax_seilbahnschwebebahn" ns="jdbc:postgresql:testbed:public">
                    <condition lang="CQL">NOT (bahnkategorie = '2500')</condition>
                </type>
                <child name="name"/>
            </property>
        </source>
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <annotation type="message">
            <core:message xmlns:core="http://www.esdi-humboldt.eu/hale/core" category="migration">
                <core:content>
                    <core:text xml:space="preserve">Filter condition may not be valid because the entity it is applied to has been replaced</core:text>
                </core:content>
            </core:message>
        </annotation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C03716a0b-a2f7-4f4b-8d93-13d186c7af73_C433d8afa-844b-4e56-b6c8-82e369fd15ea" priority="normal">
        <target name="result">
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="inNetwork" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">'#' + _project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Verknüpft das Netzwerk-Element mit dem entsprechenden *TransportNetwork*.
Dazu wird die vorgegebene ID für das Netzwerk verwendet (Projekt-Variable).</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Ce6358df9-93d2-4e61-b6d6-b9732eaec3e8" priority="normal">
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C3788abbd-19cd-40a4-bed6-28bd52ec54ee" priority="normal">
        <target>
            <property>
                <type name="CablewayLinkType" ns="http://inspire.ec.europa.eu/schemas/tn-c/4.0"/>
                <child name="validTo" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C1eb2d011-34d1-4077-8388-f7fbdb1659b9" priority="low">
        <target>
            <class>
                <type name="ConditionOfFacilityType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Die Code-Liste für ConditionOfFacility
def codeList = 'http://inspire.ec.europa.eu/codelist/ConditionOfFacilityValue'

def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein ConditionOfFacility-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.conditionOfFacility.consume { key, values -&gt;
	def _id = 'ConditionOfFacility_' + _project.vars.THEME_DISTINGUISHER + '_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		currentStatus {
			href( "$codeList/$key" )
		}
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
        <documentation>Erstellt ein `ConditionOfFacility`-Objekt für jeden in den Daten vorkommenden Wert der [ConditionOfFacilityValue Code-Liste](http://inspire.ec.europa.eu/codelist/ConditionOfFacilityValue).

Die INSPIRE localId und die GML id werden dabei basierend auf dem Namen der Objektart und dem repräsentierten Code-Listen Wert gebildet, z.B. `ConditionOfFacility_functional`.

Es werden Referenzen (`NetworkReference`) zu allen Netzwerk-Elementen (z.B. *TransportLinks* und *TransportAreas*) erstellt, welche die entsprechende Eigenschaft aufweisen. Diese Information wurde zuvor beim Erstellen dieser Features in einem Index abgelegt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C1eb2d011-34d1-4077-8388-f7fbdb1659b9" priority="normal">
        <target>
            <property>
                <type name="ConditionOfFacilityType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C1eb2d011-34d1-4077-8388-f7fbdb1659b9" priority="normal">
        <target>
            <property>
                <type name="ConditionOfFacilityType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C376c9fef-ac45-4e2c-9941-651740ba7400" priority="lowest">
        <target>
            <class>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collector

withTransformationContext {
	collector = _.context.collector(it)
}

_target {
	// Verknüpfung zu gesammelten Netzwerk-Elementen
	collector.network.each { id -&gt;
		elements {
			href( "#$id" )
		}
	}
}

</core:text>
        </complexParameter>
        <documentation>Erstellt das *TransportNetwork* für diese Netzwerk.

Zuvor wurde beim Erstellen jedes Netzwerk-Elements dessen GML id in einem Index abgelegt. Diese Information wird hier nun genutzt um auf alle Elemente des Netzwerks zu verweisen.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C60a849e5-b891-4866-8022-0cd07e0f01f4" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="language" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="deu" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C8bd6e468-105d-4337-a3e7-f7355ed60664" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="nameStatus" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/NameStatusValue/official" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C56e9b1b9-1ade-49d5-9f53-37423fe9d061" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="nativeness" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="href" ns="http://www.w3.org/1999/xlink"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/codelist/NativenessValue/endonym" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cf2ce1338-3fce-4a09-807d-09c3e76262d0" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="pronunciation" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="Cd1613f96-fd11-4e0b-b093-d38ce17cb580" priority="normal">
        <target name="result">
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="sourceOfName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def modellArt = _project.vars.ADV_MODELLART
if (modellArt) {
	_target(modellArt)
}
else {
	_target {
		nilReason( 'unknown' )
	}
}
</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Bestimmung aus Projekt-Variable (`ADV_MODELLART`) falls vorhanden, andernfalls wird *nilReason* auf `unknown` gesetzt.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cd4048617-c86f-4863-99b5-3e9f0635a8f5" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="spelling" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="SpellingOfName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="script" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="Latn" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C76fb8de5-dd5d-47c3-824e-3c37906a2c89" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="geographicalName" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="GeographicalName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="spelling" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="SpellingOfName" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
                <child name="text" ns="http://inspire.ec.europa.eu/schemas/gn/4.0"/>
            </property>
        </target>
        <parameter value="{{project:NETWORK_NAME}}" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="C79bec27b-cdca-459d-9ecc-540aeca29d4b" priority="normal">
        <target name="result">
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="id" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">_project.vars.NETWORK_ID</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Weist die vorgegebene lokale ID für das Netzwerk zu.

Die Vorgabe kann über eine Projekt-Variable überschrieben werden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy" id="Cad28e1b9-331b-4b75-838f-94b202fdba1f" priority="normal">
        <target name="result">
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
            </property>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
// Zusammenfügen von INSPIRE namespace und localId

// namespace
def namespace = _project.vars.INSPIRE_NAMESPACE
// localId (vorgegebene localId für das Netzwerk)
def id = _project.vars.NETWORK_ID

if (namespace) {
  if (!namespace.endsWith('/')) {
    namespace = namespace + '/'
  }
  
  // namespace und id als Ergebnis
  namespace + id
}
else {
  // nur id als Ergebnis
  id
}
</core:text>
        </complexParameter>
        <parameter value="false" name="variablesAsInstances"/>
        <documentation>Erzeugt einen GML identifier basierend auf der INSPIRE ID. Dazu wird der vorgegebene INSPIRE Namespace und die vorgegebene lokale ID für das Netzwerk hinzugezogen.

Beide Vorgaben können über eine Projekt-Variable überschrieben werden.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Cc9255943-592d-4e33-b874-03846d8c9a3c" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="identifier" ns="http://www.opengis.net/gml/3.2"/>
                <child name="codeSpace"/>
            </property>
        </target>
        <parameter value="http://inspire.ec.europa.eu/ids" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="Caddb8db5-f486-4664-a6b8-edd9eb936efe" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="localId" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
        <parameter value="{{project:NETWORK_ID}}" name="value"/>
        <documentation>Weist die vorgegebene lokale ID für das Netzwerk zu.

Die Vorgabe kann über eine Projekt-Variable überschrieben werden.</documentation>
    </cell>
    <cell relation="custom:alignment:adv.inspire.namespace" id="C935f563e-2939-4fcc-aecc-8029498b746b" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="inspireId" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="Identifier" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
                <child name="namespace" ns="http://inspire.ec.europa.eu/schemas/base/3.3"/>
            </property>
        </target>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C13ad15bd-b849-403e-bcf4-ec122b3998bd" priority="normal">
        <target>
            <property>
                <type name="TransportNetworkType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="typeOfTransport" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
            </property>
        </target>
        <parameter value="cable" name="value"/>
    </cell>
    <cell relation="eu.esdihumboldt.cst.functions.groovy.create" id="C00cccf8c-b815-4fa9-b89c-6f37d12ae435" priority="lowest">
        <target>
            <class>
                <type name="VerticalPositionType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
            </class>
        </target>
        <complexParameter name="script">
            <core:text xmlns:core="http://www.esdi-humboldt.eu/hale/core" xml:space="preserve">
def collect
withTransformationContext {
	collect = _.context.collector(it)
}

// Erstelle ein VerticalPosition-Objekt für jeden vorkommenden Wert
//
// Inhalt der hier gesetzt wird sind die Identifier und die Verknüpfungen
// zu den entsprechenden Netzwerk-Elementen
collect.verticalPosition.consume { key, values -&gt;
	def _id = 'VerticalPosition_' + _project.vars.THEME_DISTINGUISHER + '_' + key
	def _ns = _project.vars.INSPIRE_NAMESPACE
	
	_target {
		verticalPosition( key )
		id( _id )
		inspireId {
			Identifier {
				namespace( _ns )
				localId( _id )
			}
		}
		identifier( _ns ? (_ns.endsWith('/') ? _ns : _ns + '/') + _id : _id ) {
			codeSpace( 'http://inspire.ec.europa.eu/ids' )
		}
		
		// Referenz zu gesammelten Netzwerk-Elementen mit dieser Eigenschaft
		values.each { linkId -&gt;
			networkRef {
				NetworkReference {
					element {
						href( "#$linkId" )
					}
				}
			}
		}
	}
}
</core:text>
        </complexParameter>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C6563043b-57b7-4264-b3ff-6264b547216f_C00cccf8c-b815-4fa9-b89c-6f37d12ae435" priority="normal">
        <target>
            <property>
                <type name="VerticalPositionType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="beginLifespanVersion" ns="http://inspire.ec.europa.eu/schemas/net/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>`TransportProperty`-Objekte sind im Rahmen der Transformation neu gebildete Objekte und übernehmen daher keine Information für `beginLifespanVersion` aus den Quell-Daten.</documentation>
    </cell>
    <cell relation="eu.esdihumboldt.hale.align.assign" id="C9fbdcf9a-e35a-4f33-b915-77155350de27_C00cccf8c-b815-4fa9-b89c-6f37d12ae435" priority="normal">
        <target>
            <property>
                <type name="VerticalPositionType" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="validFrom" ns="http://inspire.ec.europa.eu/schemas/tn/4.0"/>
                <child name="nilReason"/>
            </property>
        </target>
        <parameter value="other:unpopulated" name="value"/>
        <documentation>Diese Information ist im 3A-Modell nicht vorhanden.</documentation>
    </cell>
</alignment>
